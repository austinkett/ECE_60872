diff --git a/ext/standard/Makefile.frag b/ext/standard/Makefile.frag
index 8b6e3e233ab1..5efeeed5940d 100644
--- a/ext/standard/Makefile.frag
+++ b/ext/standard/Makefile.frag
@@ -1,10 +1,12 @@
-
 $(srcdir)/var_unserializer.c: $(srcdir)/var_unserializer.re
 	@(cd $(top_srcdir); $(RE2C) --no-generation-date -b -o ext/standard/var_unserializer.c ext/standard/var_unserializer.re)
 
 $(srcdir)/url_scanner_ex.c: $(srcdir)/url_scanner_ex.re
 	@(cd $(top_srcdir); $(RE2C) --no-generation-date -b -o ext/standard/url_scanner_ex.c	ext/standard/url_scanner_ex.re)
 
+$(srcdir)/url_parser_ex.c: $(srcdir)/url_parser_ex.re
+	@(cd $(top_srcdir); $(RE2C) --no-generation-date -b -o ext/standard/url_parser_ex.c	ext/standard/url_parser_ex.re)
+
 $(builddir)/info.lo: $(builddir)/../../main/build-defs.h
 
 $(builddir)/basic_functions.lo: $(top_srcdir)/Zend/zend_language_parser.h
diff --git a/ext/standard/config.m4 b/ext/standard/config.m4
index c73dace75418..3c70287e5db8 100644
--- a/ext/standard/config.m4
+++ b/ext/standard/config.m4
@@ -560,7 +560,7 @@ PHP_NEW_EXTENSION(standard, array.c base64.c basic_functions.c browscap.c crc32.
                             microtime.c pack.c pageinfo.c quot_print.c rand.c mt_rand.c \
                             soundex.c string.c scanf.c syslog.c type.c uniqid.c url.c \
                             var.c versioning.c assert.c strnatcmp.c levenshtein.c \
-                            incomplete_class.c url_scanner_ex.c ftp_fopen_wrapper.c \
+                            incomplete_class.c url_parser_ex.c url_scanner_ex.c ftp_fopen_wrapper.c \
                             http_fopen_wrapper.c php_fopen_wrapper.c credits.c css.c \
                             var_unserializer.c ftok.c sha1.c user_filters.c uuencode.c \
                             filters.c proc_open.c streamsfuncs.c http.c password.c \
diff --git a/ext/standard/tests/strings/url_t.phpt b/ext/standard/tests/strings/url_t.phpt
deleted file mode 100644
index 8fdddcb9f504..000000000000
--- a/ext/standard/tests/strings/url_t.phpt
+++ /dev/null
@@ -1,756 +0,0 @@
---TEST--
-parse_url() function
---FILE--
-<?php
-$sample_urls = array (
-'',
-'64.246.30.37',
-'http://64.246.30.37',
-'http://64.246.30.37/',
-'64.246.30.37/',
-'64.246.30.37:80/',
-'php.net',
-'php.net/',
-'http://php.net',
-'http://php.net/',
-'www.php.net',
-'www.php.net/',
-'http://www.php.net',
-'http://www.php.net/',
-'www.php.net:80',
-'http://www.php.net:80',
-'http://www.php.net:80/',
-'http://www.php.net/index.php',
-'www.php.net/?',
-'www.php.net:80/?',
-'http://www.php.net/?',
-'http://www.php.net:80/?',
-'http://www.php.net:80/index.php',
-'http://www.php.net:80/foo/bar/index.php',
-'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php',
-'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5',
-'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/',
-'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php',
-'http://www.php.net:80/this/../a/../deep/directory',
-'http://www.php.net:80/this/../a/../deep/directory/',
-'http://www.php.net:80/this/is/a/very/deep/directory/../file.php',
-'http://www.php.net:80/index.php',
-'http://www.php.net:80/index.php?',
-'http://www.php.net:80/#foo',
-'http://www.php.net:80/?#',
-'http://www.php.net:80/?test=1',
-'http://www.php.net/?test=1&',
-'http://www.php.net:80/?&',
-'http://www.php.net:80/index.php?test=1&',
-'http://www.php.net/index.php?&',
-'http://www.php.net:80/index.php?foo&',
-'http://www.php.net/index.php?&foo',
-'http://www.php.net:80/index.php?test=1&test2=char&test3=mixesCI',
-'www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123',
-'http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123',
-'http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123',
-'http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123',
-'http://secret:hideout@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123',
-'http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123',
-'http://secret:hid:out@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123',
-'nntp://news.php.net',
-'ftp://ftp.gnu.org/gnu/glic/glibc.tar.gz',
-'zlib:http://foo@bar',
-'zlib:filename.txt',
-'zlib:/path/to/my/file/file.txt',
-'foo://foo@bar',
-'mailto:me@mydomain.com',
-'/foo.php?a=b&c=d',
-'foo.php?a=b&c=d',
-'http://user:passwd@www.example.com:8080?bar=1&boom=0',
-'file:///path/to/file',
-'file://path/to/file',
-'file:/path/to/file',
-'http://1.2.3.4:/abc.asp?a=1&b=2',
-'http://foo.com#bar',
-'scheme:',
-'foo+bar://baz@bang/bla',
-'gg:9130731',
-'http://user:@pass@host/path?argument?value#etc',
-);
-
-    foreach ($sample_urls as $url) {
-        echo "\n--> $url: ";
-        var_dump(@parse_url($url));
-    }
-
-    $url = 'http://secret:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123';
-    foreach (array(PHP_URL_SCHEME,PHP_URL_HOST,PHP_URL_PORT,PHP_URL_USER,PHP_URL_PASS,PHP_URL_PATH,PHP_URL_QUERY,PHP_URL_FRAGMENT) as $v) {
-	var_dump(parse_url($url, $v));
-    }
-?>
---EXPECT--
---> : array(1) {
-  ["path"]=>
-  string(0) ""
-}
-
---> 64.246.30.37: array(1) {
-  ["path"]=>
-  string(12) "64.246.30.37"
-}
-
---> http://64.246.30.37: array(2) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(12) "64.246.30.37"
-}
-
---> http://64.246.30.37/: array(3) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(12) "64.246.30.37"
-  ["path"]=>
-  string(1) "/"
-}
-
---> 64.246.30.37/: array(1) {
-  ["path"]=>
-  string(13) "64.246.30.37/"
-}
-
---> 64.246.30.37:80/: array(3) {
-  ["host"]=>
-  string(12) "64.246.30.37"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-}
-
---> php.net: array(1) {
-  ["path"]=>
-  string(7) "php.net"
-}
-
---> php.net/: array(1) {
-  ["path"]=>
-  string(8) "php.net/"
-}
-
---> http://php.net: array(2) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(7) "php.net"
-}
-
---> http://php.net/: array(3) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(7) "php.net"
-  ["path"]=>
-  string(1) "/"
-}
-
---> www.php.net: array(1) {
-  ["path"]=>
-  string(11) "www.php.net"
-}
-
---> www.php.net/: array(1) {
-  ["path"]=>
-  string(12) "www.php.net/"
-}
-
---> http://www.php.net: array(2) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-}
-
---> http://www.php.net/: array(3) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["path"]=>
-  string(1) "/"
-}
-
---> www.php.net:80: array(2) {
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-}
-
---> http://www.php.net:80: array(3) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-}
-
---> http://www.php.net:80/: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-}
-
---> http://www.php.net/index.php: array(3) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["path"]=>
-  string(10) "/index.php"
-}
-
---> www.php.net/?: array(1) {
-  ["path"]=>
-  string(12) "www.php.net/"
-}
-
---> www.php.net:80/?: array(3) {
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-}
-
---> http://www.php.net/?: array(3) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["path"]=>
-  string(1) "/"
-}
-
---> http://www.php.net:80/?: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-}
-
---> http://www.php.net:80/index.php: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(10) "/index.php"
-}
-
---> http://www.php.net:80/foo/bar/index.php: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(18) "/foo/bar/index.php"
-}
-
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(53) "/this/is/a/very/deep/directory/structure/and/file.php"
-}
-
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5: array(5) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(53) "/this/is/a/very/deep/directory/structure/and/file.php"
-  ["query"]=>
-  string(37) "lots=1&of=2&parameters=3&too=4&here=5"
-}
-
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(45) "/this/is/a/very/deep/directory/structure/and/"
-}
-
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(53) "/this/is/a/very/deep/directory/structure/and/file.php"
-}
-
---> http://www.php.net:80/this/../a/../deep/directory: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(28) "/this/../a/../deep/directory"
-}
-
---> http://www.php.net:80/this/../a/../deep/directory/: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(29) "/this/../a/../deep/directory/"
-}
-
---> http://www.php.net:80/this/is/a/very/deep/directory/../file.php: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(42) "/this/is/a/very/deep/directory/../file.php"
-}
-
---> http://www.php.net:80/index.php: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(10) "/index.php"
-}
-
---> http://www.php.net:80/index.php?: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(10) "/index.php"
-}
-
---> http://www.php.net:80/#foo: array(5) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-  ["fragment"]=>
-  string(3) "foo"
-}
-
---> http://www.php.net:80/?#: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-}
-
---> http://www.php.net:80/?test=1: array(5) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-  ["query"]=>
-  string(6) "test=1"
-}
-
---> http://www.php.net/?test=1&: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["path"]=>
-  string(1) "/"
-  ["query"]=>
-  string(7) "test=1&"
-}
-
---> http://www.php.net:80/?&: array(5) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(1) "/"
-  ["query"]=>
-  string(1) "&"
-}
-
---> http://www.php.net:80/index.php?test=1&: array(5) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(7) "test=1&"
-}
-
---> http://www.php.net/index.php?&: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(1) "&"
-}
-
---> http://www.php.net:80/index.php?foo&: array(5) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(4) "foo&"
-}
-
---> http://www.php.net/index.php?&foo: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(4) "&foo"
-}
-
---> http://www.php.net:80/index.php?test=1&test2=char&test3=mixesCI: array(5) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(31) "test=1&test2=char&test3=mixesCI"
-}
-
---> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(5) {
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(31) "test=1&test2=char&test3=mixesCI"
-  ["fragment"]=>
-  string(16) "some_page_ref123"
-}
-
---> http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(7) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["user"]=>
-  string(6) "secret"
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(31) "test=1&test2=char&test3=mixesCI"
-  ["fragment"]=>
-  string(16) "some_page_ref123"
-}
-
---> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(7) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["user"]=>
-  string(6) "secret"
-  ["pass"]=>
-  string(0) ""
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(31) "test=1&test2=char&test3=mixesCI"
-  ["fragment"]=>
-  string(16) "some_page_ref123"
-}
-
---> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(8) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["user"]=>
-  string(0) ""
-  ["pass"]=>
-  string(7) "hideout"
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(31) "test=1&test2=char&test3=mixesCI"
-  ["fragment"]=>
-  string(16) "some_page_ref123"
-}
-
---> http://secret:hideout@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(7) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["user"]=>
-  string(6) "secret"
-  ["pass"]=>
-  string(7) "hideout"
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(31) "test=1&test2=char&test3=mixesCI"
-  ["fragment"]=>
-  string(16) "some_page_ref123"
-}
-
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: bool(false)
-
---> http://secret:hid:out@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(8) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["user"]=>
-  string(6) "secret"
-  ["pass"]=>
-  string(7) "hid:out"
-  ["path"]=>
-  string(10) "/index.php"
-  ["query"]=>
-  string(31) "test=1&test2=char&test3=mixesCI"
-  ["fragment"]=>
-  string(16) "some_page_ref123"
-}
-
---> nntp://news.php.net: array(2) {
-  ["scheme"]=>
-  string(4) "nntp"
-  ["host"]=>
-  string(12) "news.php.net"
-}
-
---> ftp://ftp.gnu.org/gnu/glic/glibc.tar.gz: array(3) {
-  ["scheme"]=>
-  string(3) "ftp"
-  ["host"]=>
-  string(11) "ftp.gnu.org"
-  ["path"]=>
-  string(22) "/gnu/glic/glibc.tar.gz"
-}
-
---> zlib:http://foo@bar: array(2) {
-  ["scheme"]=>
-  string(4) "zlib"
-  ["path"]=>
-  string(14) "http://foo@bar"
-}
-
---> zlib:filename.txt: array(2) {
-  ["scheme"]=>
-  string(4) "zlib"
-  ["path"]=>
-  string(12) "filename.txt"
-}
-
---> zlib:/path/to/my/file/file.txt: array(2) {
-  ["scheme"]=>
-  string(4) "zlib"
-  ["path"]=>
-  string(25) "/path/to/my/file/file.txt"
-}
-
---> foo://foo@bar: array(3) {
-  ["scheme"]=>
-  string(3) "foo"
-  ["host"]=>
-  string(3) "bar"
-  ["user"]=>
-  string(3) "foo"
-}
-
---> mailto:me@mydomain.com: array(2) {
-  ["scheme"]=>
-  string(6) "mailto"
-  ["path"]=>
-  string(15) "me@mydomain.com"
-}
-
---> /foo.php?a=b&c=d: array(2) {
-  ["path"]=>
-  string(8) "/foo.php"
-  ["query"]=>
-  string(7) "a=b&c=d"
-}
-
---> foo.php?a=b&c=d: array(2) {
-  ["path"]=>
-  string(7) "foo.php"
-  ["query"]=>
-  string(7) "a=b&c=d"
-}
-
---> http://user:passwd@www.example.com:8080?bar=1&boom=0: array(6) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(15) "www.example.com"
-  ["port"]=>
-  int(8080)
-  ["user"]=>
-  string(4) "user"
-  ["pass"]=>
-  string(6) "passwd"
-  ["query"]=>
-  string(12) "bar=1&boom=0"
-}
-
---> file:///path/to/file: array(2) {
-  ["scheme"]=>
-  string(4) "file"
-  ["path"]=>
-  string(13) "/path/to/file"
-}
-
---> file://path/to/file: array(3) {
-  ["scheme"]=>
-  string(4) "file"
-  ["host"]=>
-  string(4) "path"
-  ["path"]=>
-  string(8) "/to/file"
-}
-
---> file:/path/to/file: array(2) {
-  ["scheme"]=>
-  string(4) "file"
-  ["path"]=>
-  string(13) "/path/to/file"
-}
-
---> http://1.2.3.4:/abc.asp?a=1&b=2: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(7) "1.2.3.4"
-  ["path"]=>
-  string(8) "/abc.asp"
-  ["query"]=>
-  string(7) "a=1&b=2"
-}
-
---> http://foo.com#bar: array(3) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(7) "foo.com"
-  ["fragment"]=>
-  string(3) "bar"
-}
-
---> scheme:: array(1) {
-  ["scheme"]=>
-  string(6) "scheme"
-}
-
---> foo+bar://baz@bang/bla: array(4) {
-  ["scheme"]=>
-  string(7) "foo+bar"
-  ["host"]=>
-  string(4) "bang"
-  ["user"]=>
-  string(3) "baz"
-  ["path"]=>
-  string(4) "/bla"
-}
-
---> gg:9130731: array(2) {
-  ["scheme"]=>
-  string(2) "gg"
-  ["path"]=>
-  string(7) "9130731"
-}
-
---> http://user:@pass@host/path?argument?value#etc: bool(false)
-string(4) "http"
-string(11) "www.php.net"
-int(80)
-string(6) "secret"
-string(7) "hideout"
-string(10) "/index.php"
-string(31) "test=1&test2=char&test3=mixesCI"
-string(16) "some_page_ref123"
-
diff --git a/ext/standard/tests/url/bug55399.phpt b/ext/standard/tests/url/bug55399.phpt
index 619c08da6d04..8e0eaef07076 100644
--- a/ext/standard/tests/url/bug55399.phpt
+++ b/ext/standard/tests/url/bug55399.phpt
@@ -7,4 +7,7 @@ var_dump(parse_url(":"));
 
 ?>
 --EXPECT--
-bool(false)
+array(1) {
+  ["path"]=>
+  string(1) ":"
+}
diff --git a/ext/standard/tests/url/parse_url_basic_001.phpt b/ext/standard/tests/url/parse_url_basic_001.phpt
index 2d41ba9c4572..802d16c8b2ac 100644
--- a/ext/standard/tests/url/parse_url_basic_001.phpt
+++ b/ext/standard/tests/url/parse_url_basic_001.phpt
@@ -1,11 +1,11 @@
 --TEST--
-Test parse_url() function: Parse a load of URLs without specifying the component 
+Test parse_url() function: Parse a load of URLs without specifying the component
 --FILE--
 <?php
 /* Prototype  : proto mixed parse_url(string url, [int url_component])
- * Description: Parse a and return its components 
+ * Description: Parse a and return its components
  * Source code: ext/standard/url.c
- * Alias to functions: 
+ * Alias to functions:
  */
 
 /*
@@ -18,7 +18,6 @@ foreach ($urls as $url) {
 	var_dump(parse_url($url));
 }
 
-echo "Done";
 ?>
 --EXPECTF--
 
@@ -48,13 +47,9 @@ echo "Done";
   string(13) "64.246.30.37/"
 }
 
---> 64.246.30.37:80/: array(3) {
-  ["host"]=>
-  string(12) "64.246.30.37"
-  ["port"]=>
-  int(80)
+--> 64.246.30.37:80/: array(1) {
   ["path"]=>
-  string(1) "/"
+  string(16) "64.246.30.37:80/"
 }
 
 --> php.net: array(1) {
@@ -109,11 +104,11 @@ echo "Done";
   string(1) "/"
 }
 
---> www.php.net:80: array(2) {
-  ["host"]=>
+--> www.php.net:80/: array(2) {
+  ["scheme"]=>
   string(11) "www.php.net"
-  ["port"]=>
-  int(80)
+  ["path"]=>
+  string(3) "80/"
 }
 
 --> http://www.php.net:80: array(3) {
@@ -150,13 +145,11 @@ echo "Done";
   string(12) "www.php.net/"
 }
 
---> www.php.net:80/?: array(3) {
-  ["host"]=>
+--> www.php.net:80/?: array(2) {
+  ["scheme"]=>
   string(11) "www.php.net"
-  ["port"]=>
-  int(80)
   ["path"]=>
-  string(1) "/"
+  string(3) "80/"
 }
 
 --> http://www.php.net/?: array(3) {
@@ -236,17 +229,6 @@ echo "Done";
   string(45) "/this/is/a/very/deep/directory/structure/and/"
 }
 
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php: array(4) {
-  ["scheme"]=>
-  string(4) "http"
-  ["host"]=>
-  string(11) "www.php.net"
-  ["port"]=>
-  int(80)
-  ["path"]=>
-  string(53) "/this/is/a/very/deep/directory/structure/and/file.php"
-}
-
 --> http://www.php.net:80/this/../a/../deep/directory: array(4) {
   ["scheme"]=>
   string(4) "http"
@@ -424,13 +406,11 @@ echo "Done";
   string(31) "test=1&test2=char&test3=mixesCI"
 }
 
---> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(5) {
-  ["host"]=>
+--> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(4) {
+  ["scheme"]=>
   string(11) "www.php.net"
-  ["port"]=>
-  int(80)
   ["path"]=>
-  string(10) "/index.php"
+  string(12) "80/index.php"
   ["query"]=>
   string(31) "test=1&test2=char&test3=mixesCI"
   ["fragment"]=>
@@ -454,15 +434,13 @@ echo "Done";
   string(16) "some_page_ref123"
 }
 
---> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(7) {
+--> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(6) {
   ["scheme"]=>
   string(4) "http"
   ["host"]=>
   string(11) "www.php.net"
   ["user"]=>
   string(6) "secret"
-  ["pass"]=>
-  string(0) ""
   ["path"]=>
   string(10) "/index.php"
   ["query"]=>
@@ -471,15 +449,13 @@ echo "Done";
   string(16) "some_page_ref123"
 }
 
---> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(8) {
+--> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(7) {
   ["scheme"]=>
   string(4) "http"
   ["host"]=>
   string(11) "www.php.net"
   ["port"]=>
   int(80)
-  ["user"]=>
-  string(0) ""
   ["pass"]=>
   string(7) "hideout"
   ["path"]=>
@@ -719,49 +695,46 @@ echo "Done";
   string(9) "/blah.com"
 }
 
---> x://::abc/?: bool(false)
+--> x://::abc/?: array(2) {
+  ["scheme"]=>
+  string(1) "x"
+  ["path"]=>
+  string(5) ":abc/"
+}
 
 --> http://::?: array(2) {
   ["scheme"]=>
   string(4) "http"
-  ["host"]=>
+  ["path"]=>
   string(1) ":"
 }
 
 --> http://::#: array(2) {
   ["scheme"]=>
   string(4) "http"
-  ["host"]=>
+  ["path"]=>
   string(1) ":"
 }
 
---> x://::6.5: array(3) {
+--> x://::6.5: array(2) {
   ["scheme"]=>
   string(1) "x"
-  ["host"]=>
-  string(1) ":"
-  ["port"]=>
-  int(6)
+  ["path"]=>
+  string(4) ":6.5"
 }
 
---> http://?:/: array(3) {
+--> http://?:/: array(2) {
   ["scheme"]=>
   string(4) "http"
-  ["host"]=>
-  string(1) "?"
-  ["path"]=>
-  string(1) "/"
+  ["query"]=>
+  string(2) ":/"
 }
 
---> http://@?:/: array(4) {
+--> http://@?:/: array(2) {
   ["scheme"]=>
   string(4) "http"
-  ["host"]=>
-  string(1) "?"
-  ["user"]=>
-  string(0) ""
-  ["path"]=>
-  string(1) "/"
+  ["query"]=>
+  string(2) ":/"
 }
 
 --> file:///:: array(2) {
@@ -775,7 +748,7 @@ echo "Done";
   ["scheme"]=>
   string(4) "file"
   ["path"]=>
-  string(3) "a:/"
+  string(4) "/a:/"
 }
 
 --> file:///ab:/: array(2) {
@@ -785,18 +758,11 @@ echo "Done";
   string(5) "/ab:/"
 }
 
---> file:///a:/: array(2) {
-  ["scheme"]=>
-  string(4) "file"
-  ["path"]=>
-  string(3) "a:/"
-}
-
 --> file:///@:/: array(2) {
   ["scheme"]=>
   string(4) "file"
   ["path"]=>
-  string(3) "@:/"
+  string(4) "/@:/"
 }
 
 --> file:///:80/: array(2) {
@@ -806,24 +772,14 @@ echo "Done";
   string(5) "/:80/"
 }
 
---> []: array(1) {
-  ["path"]=>
-  string(2) "[]"
-}
+--> []: NULL
 
---> http://[x:80]/: array(3) {
+--> http://[x:80]/: array(1) {
   ["scheme"]=>
   string(4) "http"
-  ["host"]=>
-  string(6) "[x:80]"
-  ["path"]=>
-  string(1) "/"
 }
 
---> : array(1) {
-  ["path"]=>
-  string(0) ""
-}
+--> : NULL
 
 --> /: array(1) {
   ["path"]=>
@@ -834,40 +790,142 @@ echo "Done";
   ["path"]=>
   string(11) "/rest/Users"
   ["query"]=>
-  string(19) "filter={"id":"123"}"
+  string(7) "filter="
 }
 
---> http:///blah.com: bool(false)
+--> http:///blah.com: array(2) {
+  ["scheme"]=>
+  string(4) "http"
+  ["path"]=>
+  string(9) "/blah.com"
+}
 
---> http://:80: bool(false)
+--> http://:80: array(2) {
+  ["scheme"]=>
+  string(4) "http"
+  ["port"]=>
+  int(80)
+}
 
---> http://user@:80: bool(false)
+--> http://user@:80: array(3) {
+  ["scheme"]=>
+  string(4) "http"
+  ["port"]=>
+  int(80)
+  ["user"]=>
+  string(4) "user"
+}
 
---> http://user:pass@:80: bool(false)
+--> http://user:pass@:80: array(4) {
+  ["scheme"]=>
+  string(4) "http"
+  ["port"]=>
+  int(80)
+  ["user"]=>
+  string(4) "user"
+  ["pass"]=>
+  string(4) "pass"
+}
 
---> http://:: bool(false)
+--> http://:: array(1) {
+  ["scheme"]=>
+  string(4) "http"
+}
 
---> http://@/: bool(false)
+--> http://@/: array(2) {
+  ["scheme"]=>
+  string(4) "http"
+  ["path"]=>
+  string(1) "/"
+}
 
---> http://@:/: bool(false)
+--> http://@:/: array(2) {
+  ["scheme"]=>
+  string(4) "http"
+  ["path"]=>
+  string(1) "/"
+}
 
---> http://:/: bool(false)
+--> http://:/: array(2) {
+  ["scheme"]=>
+  string(4) "http"
+  ["path"]=>
+  string(1) "/"
+}
 
---> http://?: bool(false)
+--> http://?: array(1) {
+  ["scheme"]=>
+  string(4) "http"
+}
 
---> http://#: bool(false)
+--> http://#: array(1) {
+  ["scheme"]=>
+  string(4) "http"
+}
 
---> http://?:: bool(false)
+--> http://?:: array(2) {
+  ["scheme"]=>
+  string(4) "http"
+  ["query"]=>
+  string(1) ":"
+}
 
---> http://:?: bool(false)
+--> http://:?: array(1) {
+  ["scheme"]=>
+  string(4) "http"
+}
 
---> http://blah.com:123456: bool(false)
+--> http://blah.com:123456: array(3) {
+  ["scheme"]=>
+  string(4) "http"
+  ["host"]=>
+  string(8) "blah.com"
+  ["port"]=>
+  int(123456)
+}
 
---> http://blah.com:abcdef: bool(false)
+--> http://blah.com:abcdef: array(3) {
+  ["scheme"]=>
+  string(4) "http"
+  ["host"]=>
+  string(8) "blah.com"
+  ["path"]=>
+  string(6) "abcdef"
+}
 
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: bool(false)
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123: array(6) {
+  ["scheme"]=>
+  string(4) "http"
+  ["host"]=>
+  string(7) "hideout"
+  ["user"]=>
+  string(6) "secret"
+  ["path"]=>
+  string(25) "@www.php.net:80/index.php"
+  ["query"]=>
+  string(31) "test=1&test2=char&test3=mixesCI"
+  ["fragment"]=>
+  string(16) "some_page_ref123"
+}
 
---> http://user:@pass@host/path?argument?value#etc: bool(false)
+--> http://user:@pass@host/path?argument?value#etc: array(6) {
+  ["scheme"]=>
+  string(4) "http"
+  ["host"]=>
+  string(4) "pass"
+  ["user"]=>
+  string(4) "user"
+  ["path"]=>
+  string(10) "@host/path"
+  ["query"]=>
+  string(14) "argument?value"
+  ["fragment"]=>
+  string(3) "etc"
+}
 
---> http://foo.com\@bar.com: bool(false)
-Done
+--> http://foo.com\@bar.com: array(2) {
+  ["scheme"]=>
+  string(4) "http"
+  ["host"]=>
+  string(7) "foo.com"
+}
diff --git a/ext/standard/tests/url/parse_url_basic_002.phpt b/ext/standard/tests/url/parse_url_basic_002.phpt
index 476b89716877..d860bcb08dec 100644
--- a/ext/standard/tests/url/parse_url_basic_002.phpt
+++ b/ext/standard/tests/url/parse_url_basic_002.phpt
@@ -35,12 +35,12 @@ echo "Done";
 --> www.php.net/   : NULL
 --> http://www.php.net   : string(4) "http"
 --> http://www.php.net/   : string(4) "http"
---> www.php.net:80   : NULL
+--> www.php.net:80/   : string(11) "www.php.net"
 --> http://www.php.net:80   : string(4) "http"
 --> http://www.php.net:80/   : string(4) "http"
 --> http://www.php.net/index.php   : string(4) "http"
 --> www.php.net/?   : NULL
---> www.php.net:80/?   : NULL
+--> www.php.net:80/?   : string(11) "www.php.net"
 --> http://www.php.net/?   : string(4) "http"
 --> http://www.php.net:80/?   : string(4) "http"
 --> http://www.php.net:80/index.php   : string(4) "http"
@@ -48,7 +48,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : string(4) "http"
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : string(4) "http"
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : string(4) "http"
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : string(4) "http"
 --> http://www.php.net:80/this/../a/../deep/directory   : string(4) "http"
 --> http://www.php.net:80/this/../a/../deep/directory/   : string(4) "http"
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : string(4) "http"
@@ -64,7 +63,7 @@ echo "Done";
 --> http://www.php.net:80/index.php?foo&   : string(4) "http"
 --> http://www.php.net/index.php?&foo   : string(4) "http"
 --> http://www.php.net:80/index.php?test=1&test2=char&test3=mixesCI   : string(4) "http"
---> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
+--> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(11) "www.php.net"
 --> http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(4) "http"
 --> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(4) "http"
 --> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(4) "http"
@@ -93,7 +92,7 @@ echo "Done";
 --> http://x:?   : string(4) "http"
 --> x:blah.com   : string(1) "x"
 --> x:/blah.com   : string(1) "x"
---> x://::abc/?   : bool(false)
+--> x://::abc/?   : string(1) "x"
 --> http://::?   : string(4) "http"
 --> http://::#   : string(4) "http"
 --> x://::6.5   : string(1) "x"
@@ -102,7 +101,6 @@ echo "Done";
 --> file:///:   : string(4) "file"
 --> file:///a:/   : string(4) "file"
 --> file:///ab:/   : string(4) "file"
---> file:///a:/   : string(4) "file"
 --> file:///@:/   : string(4) "file"
 --> file:///:80/   : string(4) "file"
 --> []   : NULL
@@ -110,21 +108,21 @@ echo "Done";
 -->    : NULL
 --> /   : NULL
 --> /rest/Users?filter={"id":"123"}   : NULL
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> http:///blah.com   : string(4) "http"
+--> http://:80   : string(4) "http"
+--> http://user@:80   : string(4) "http"
+--> http://user:pass@:80   : string(4) "http"
+--> http://:   : string(4) "http"
+--> http://@/   : string(4) "http"
+--> http://@:/   : string(4) "http"
+--> http://:/   : string(4) "http"
+--> http://?   : string(4) "http"
+--> http://#   : string(4) "http"
+--> http://?:   : string(4) "http"
+--> http://:?   : string(4) "http"
+--> http://blah.com:123456   : string(4) "http"
+--> http://blah.com:abcdef   : string(4) "http"
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(4) "http"
+--> http://user:@pass@host/path?argument?value#etc   : string(4) "http"
+--> http://foo.com\@bar.com   : string(4) "http"
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_003.phpt b/ext/standard/tests/url/parse_url_basic_003.phpt
index c7f3d9944115..4fda519ecb82 100644
--- a/ext/standard/tests/url/parse_url_basic_003.phpt
+++ b/ext/standard/tests/url/parse_url_basic_003.phpt
@@ -25,7 +25,7 @@ echo "Done";
 --> http://64.246.30.37   : string(12) "64.246.30.37"
 --> http://64.246.30.37/   : string(12) "64.246.30.37"
 --> 64.246.30.37/   : NULL
---> 64.246.30.37:80/   : string(12) "64.246.30.37"
+--> 64.246.30.37:80/   : NULL
 --> php.net   : NULL
 --> php.net/   : NULL
 --> http://php.net   : string(7) "php.net"
@@ -34,12 +34,12 @@ echo "Done";
 --> www.php.net/   : NULL
 --> http://www.php.net   : string(11) "www.php.net"
 --> http://www.php.net/   : string(11) "www.php.net"
---> www.php.net:80   : string(11) "www.php.net"
+--> www.php.net:80/   : NULL
 --> http://www.php.net:80   : string(11) "www.php.net"
 --> http://www.php.net:80/   : string(11) "www.php.net"
 --> http://www.php.net/index.php   : string(11) "www.php.net"
 --> www.php.net/?   : NULL
---> www.php.net:80/?   : string(11) "www.php.net"
+--> www.php.net:80/?   : NULL
 --> http://www.php.net/?   : string(11) "www.php.net"
 --> http://www.php.net:80/?   : string(11) "www.php.net"
 --> http://www.php.net:80/index.php   : string(11) "www.php.net"
@@ -47,7 +47,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : string(11) "www.php.net"
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : string(11) "www.php.net"
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : string(11) "www.php.net"
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : string(11) "www.php.net"
 --> http://www.php.net:80/this/../a/../deep/directory   : string(11) "www.php.net"
 --> http://www.php.net:80/this/../a/../deep/directory/   : string(11) "www.php.net"
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : string(11) "www.php.net"
@@ -63,7 +62,7 @@ echo "Done";
 --> http://www.php.net:80/index.php?foo&   : string(11) "www.php.net"
 --> http://www.php.net/index.php?&foo   : string(11) "www.php.net"
 --> http://www.php.net:80/index.php?test=1&test2=char&test3=mixesCI   : string(11) "www.php.net"
---> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(11) "www.php.net"
+--> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
 --> http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(11) "www.php.net"
 --> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(11) "www.php.net"
 --> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(11) "www.php.net"
@@ -92,38 +91,37 @@ echo "Done";
 --> http://x:?   : string(1) "x"
 --> x:blah.com   : NULL
 --> x:/blah.com   : NULL
---> x://::abc/?   : bool(false)
---> http://::?   : string(1) ":"
---> http://::#   : string(1) ":"
---> x://::6.5   : string(1) ":"
---> http://?:/   : string(1) "?"
---> http://@?:/   : string(1) "?"
+--> x://::abc/?   : NULL
+--> http://::?   : NULL
+--> http://::#   : NULL
+--> x://::6.5   : NULL
+--> http://?:/   : NULL
+--> http://@?:/   : NULL
 --> file:///:   : NULL
 --> file:///a:/   : NULL
 --> file:///ab:/   : NULL
---> file:///a:/   : NULL
 --> file:///@:/   : NULL
 --> file:///:80/   : NULL
 --> []   : NULL
---> http://[x:80]/   : string(6) "[x:80]"
+--> http://[x:80]/   : NULL
 -->    : NULL
 --> /   : NULL
 --> /rest/Users?filter={"id":"123"}   : NULL
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> http:///blah.com   : NULL
+--> http://:80   : NULL
+--> http://user@:80   : NULL
+--> http://user:pass@:80   : NULL
+--> http://:   : NULL
+--> http://@/   : NULL
+--> http://@:/   : NULL
+--> http://:/   : NULL
+--> http://?   : NULL
+--> http://#   : NULL
+--> http://?:   : NULL
+--> http://:?   : NULL
+--> http://blah.com:123456   : string(8) "blah.com"
+--> http://blah.com:abcdef   : string(8) "blah.com"
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(7) "hideout"
+--> http://user:@pass@host/path?argument?value#etc   : string(4) "pass"
+--> http://foo.com\@bar.com   : string(7) "foo.com"
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_004.phpt b/ext/standard/tests/url/parse_url_basic_004.phpt
index 3cfb345f943b..c13cc4a9a7e4 100644
--- a/ext/standard/tests/url/parse_url_basic_004.phpt
+++ b/ext/standard/tests/url/parse_url_basic_004.phpt
@@ -25,7 +25,7 @@ echo "Done";
 --> http://64.246.30.37   : NULL
 --> http://64.246.30.37/   : NULL
 --> 64.246.30.37/   : NULL
---> 64.246.30.37:80/   : int(80)
+--> 64.246.30.37:80/   : NULL
 --> php.net   : NULL
 --> php.net/   : NULL
 --> http://php.net   : NULL
@@ -34,12 +34,12 @@ echo "Done";
 --> www.php.net/   : NULL
 --> http://www.php.net   : NULL
 --> http://www.php.net/   : NULL
---> www.php.net:80   : int(80)
+--> www.php.net:80/   : NULL
 --> http://www.php.net:80   : int(80)
 --> http://www.php.net:80/   : int(80)
 --> http://www.php.net/index.php   : NULL
 --> www.php.net/?   : NULL
---> www.php.net:80/?   : int(80)
+--> www.php.net:80/?   : NULL
 --> http://www.php.net/?   : NULL
 --> http://www.php.net:80/?   : int(80)
 --> http://www.php.net:80/index.php   : int(80)
@@ -47,7 +47,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : int(80)
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : int(80)
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : int(80)
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : int(80)
 --> http://www.php.net:80/this/../a/../deep/directory   : int(80)
 --> http://www.php.net:80/this/../a/../deep/directory/   : int(80)
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : int(80)
@@ -63,7 +62,7 @@ echo "Done";
 --> http://www.php.net:80/index.php?foo&   : int(80)
 --> http://www.php.net/index.php?&foo   : NULL
 --> http://www.php.net:80/index.php?test=1&test2=char&test3=mixesCI   : int(80)
---> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : int(80)
+--> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
 --> http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : int(80)
 --> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
 --> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : int(80)
@@ -92,16 +91,15 @@ echo "Done";
 --> http://x:?   : NULL
 --> x:blah.com   : NULL
 --> x:/blah.com   : NULL
---> x://::abc/?   : bool(false)
+--> x://::abc/?   : NULL
 --> http://::?   : NULL
 --> http://::#   : NULL
---> x://::6.5   : int(6)
+--> x://::6.5   : NULL
 --> http://?:/   : NULL
 --> http://@?:/   : NULL
 --> file:///:   : NULL
 --> file:///a:/   : NULL
 --> file:///ab:/   : NULL
---> file:///a:/   : NULL
 --> file:///@:/   : NULL
 --> file:///:80/   : NULL
 --> []   : NULL
@@ -109,21 +107,21 @@ echo "Done";
 -->    : NULL
 --> /   : NULL
 --> /rest/Users?filter={"id":"123"}   : NULL
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> http:///blah.com   : NULL
+--> http://:80   : int(80)
+--> http://user@:80   : int(80)
+--> http://user:pass@:80   : int(80)
+--> http://:   : NULL
+--> http://@/   : NULL
+--> http://@:/   : NULL
+--> http://:/   : NULL
+--> http://?   : NULL
+--> http://#   : NULL
+--> http://?:   : NULL
+--> http://:?   : NULL
+--> http://blah.com:123456   : int(123456)
+--> http://blah.com:abcdef   : NULL
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
+--> http://user:@pass@host/path?argument?value#etc   : NULL
+--> http://foo.com\@bar.com   : NULL
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_005.phpt b/ext/standard/tests/url/parse_url_basic_005.phpt
index 602bd60c0ad9..84327307d1f4 100644
--- a/ext/standard/tests/url/parse_url_basic_005.phpt
+++ b/ext/standard/tests/url/parse_url_basic_005.phpt
@@ -34,7 +34,7 @@ echo "Done";
 --> www.php.net/   : NULL
 --> http://www.php.net   : NULL
 --> http://www.php.net/   : NULL
---> www.php.net:80   : NULL
+--> www.php.net:80/   : NULL
 --> http://www.php.net:80   : NULL
 --> http://www.php.net:80/   : NULL
 --> http://www.php.net/index.php   : NULL
@@ -47,7 +47,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : NULL
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory/   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : NULL
@@ -66,7 +65,7 @@ echo "Done";
 --> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
 --> http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(6) "secret"
 --> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(6) "secret"
---> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(0) ""
+--> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
 --> http://secret:hideout@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(6) "secret"
 --> http://secret:hid:out@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(6) "secret"
 --> nntp://news.php.net   : NULL
@@ -92,16 +91,15 @@ echo "Done";
 --> http://x:?   : NULL
 --> x:blah.com   : NULL
 --> x:/blah.com   : NULL
---> x://::abc/?   : bool(false)
+--> x://::abc/?   : NULL
 --> http://::?   : NULL
 --> http://::#   : NULL
 --> x://::6.5   : NULL
 --> http://?:/   : NULL
---> http://@?:/   : string(0) ""
+--> http://@?:/   : NULL
 --> file:///:   : NULL
 --> file:///a:/   : NULL
 --> file:///ab:/   : NULL
---> file:///a:/   : NULL
 --> file:///@:/   : NULL
 --> file:///:80/   : NULL
 --> []   : NULL
@@ -109,21 +107,21 @@ echo "Done";
 -->    : NULL
 --> /   : NULL
 --> /rest/Users?filter={"id":"123"}   : NULL
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> http:///blah.com   : NULL
+--> http://:80   : NULL
+--> http://user@:80   : string(4) "user"
+--> http://user:pass@:80   : string(4) "user"
+--> http://:   : NULL
+--> http://@/   : NULL
+--> http://@:/   : NULL
+--> http://:/   : NULL
+--> http://?   : NULL
+--> http://#   : NULL
+--> http://?:   : NULL
+--> http://:?   : NULL
+--> http://blah.com:123456   : NULL
+--> http://blah.com:abcdef   : NULL
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(6) "secret"
+--> http://user:@pass@host/path?argument?value#etc   : string(4) "user"
+--> http://foo.com\@bar.com   : NULL
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_006.phpt b/ext/standard/tests/url/parse_url_basic_006.phpt
index 69b7914258e4..e7e6d3080704 100644
--- a/ext/standard/tests/url/parse_url_basic_006.phpt
+++ b/ext/standard/tests/url/parse_url_basic_006.phpt
@@ -34,7 +34,7 @@ echo "Done";
 --> www.php.net/   : NULL
 --> http://www.php.net   : NULL
 --> http://www.php.net/   : NULL
---> www.php.net:80   : NULL
+--> www.php.net:80/   : NULL
 --> http://www.php.net:80   : NULL
 --> http://www.php.net:80/   : NULL
 --> http://www.php.net/index.php   : NULL
@@ -47,7 +47,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : NULL
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory/   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : NULL
@@ -65,7 +64,7 @@ echo "Done";
 --> http://www.php.net:80/index.php?test=1&test2=char&test3=mixesCI   : NULL
 --> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
 --> http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
---> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(0) ""
+--> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
 --> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(7) "hideout"
 --> http://secret:hideout@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(7) "hideout"
 --> http://secret:hid:out@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(7) "hid:out"
@@ -92,7 +91,7 @@ echo "Done";
 --> http://x:?   : NULL
 --> x:blah.com   : NULL
 --> x:/blah.com   : NULL
---> x://::abc/?   : bool(false)
+--> x://::abc/?   : NULL
 --> http://::?   : NULL
 --> http://::#   : NULL
 --> x://::6.5   : NULL
@@ -101,7 +100,6 @@ echo "Done";
 --> file:///:   : NULL
 --> file:///a:/   : NULL
 --> file:///ab:/   : NULL
---> file:///a:/   : NULL
 --> file:///@:/   : NULL
 --> file:///:80/   : NULL
 --> []   : NULL
@@ -109,21 +107,21 @@ echo "Done";
 -->    : NULL
 --> /   : NULL
 --> /rest/Users?filter={"id":"123"}   : NULL
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> http:///blah.com   : NULL
+--> http://:80   : NULL
+--> http://user@:80   : NULL
+--> http://user:pass@:80   : string(4) "pass"
+--> http://:   : NULL
+--> http://@/   : NULL
+--> http://@:/   : NULL
+--> http://:/   : NULL
+--> http://?   : NULL
+--> http://#   : NULL
+--> http://?:   : NULL
+--> http://:?   : NULL
+--> http://blah.com:123456   : NULL
+--> http://blah.com:abcdef   : NULL
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : NULL
+--> http://user:@pass@host/path?argument?value#etc   : NULL
+--> http://foo.com\@bar.com   : NULL
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_007.phpt b/ext/standard/tests/url/parse_url_basic_007.phpt
index a8cbf2f47574..6b7a3a5d5ab1 100644
--- a/ext/standard/tests/url/parse_url_basic_007.phpt
+++ b/ext/standard/tests/url/parse_url_basic_007.phpt
@@ -25,7 +25,7 @@ echo "Done";
 --> http://64.246.30.37   : NULL
 --> http://64.246.30.37/   : string(1) "/"
 --> 64.246.30.37/   : string(13) "64.246.30.37/"
---> 64.246.30.37:80/   : string(1) "/"
+--> 64.246.30.37:80/   : string(16) "64.246.30.37:80/"
 --> php.net   : string(7) "php.net"
 --> php.net/   : string(8) "php.net/"
 --> http://php.net   : NULL
@@ -34,12 +34,12 @@ echo "Done";
 --> www.php.net/   : string(12) "www.php.net/"
 --> http://www.php.net   : NULL
 --> http://www.php.net/   : string(1) "/"
---> www.php.net:80   : NULL
+--> www.php.net:80/   : string(3) "80/"
 --> http://www.php.net:80   : NULL
 --> http://www.php.net:80/   : string(1) "/"
 --> http://www.php.net/index.php   : string(10) "/index.php"
 --> www.php.net/?   : string(12) "www.php.net/"
---> www.php.net:80/?   : string(1) "/"
+--> www.php.net:80/?   : string(3) "80/"
 --> http://www.php.net/?   : string(1) "/"
 --> http://www.php.net:80/?   : string(1) "/"
 --> http://www.php.net:80/index.php   : string(10) "/index.php"
@@ -47,7 +47,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : string(53) "/this/is/a/very/deep/directory/structure/and/file.php"
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : string(53) "/this/is/a/very/deep/directory/structure/and/file.php"
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : string(45) "/this/is/a/very/deep/directory/structure/and/"
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : string(53) "/this/is/a/very/deep/directory/structure/and/file.php"
 --> http://www.php.net:80/this/../a/../deep/directory   : string(28) "/this/../a/../deep/directory"
 --> http://www.php.net:80/this/../a/../deep/directory/   : string(29) "/this/../a/../deep/directory/"
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : string(42) "/this/is/a/very/deep/directory/../file.php"
@@ -63,7 +62,7 @@ echo "Done";
 --> http://www.php.net:80/index.php?foo&   : string(10) "/index.php"
 --> http://www.php.net/index.php?&foo   : string(10) "/index.php"
 --> http://www.php.net:80/index.php?test=1&test2=char&test3=mixesCI   : string(10) "/index.php"
---> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(10) "/index.php"
+--> www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(12) "80/index.php"
 --> http://secret@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(10) "/index.php"
 --> http://secret:@www.php.net/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(10) "/index.php"
 --> http://:hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(10) "/index.php"
@@ -92,38 +91,37 @@ echo "Done";
 --> http://x:?   : NULL
 --> x:blah.com   : string(8) "blah.com"
 --> x:/blah.com   : string(9) "/blah.com"
---> x://::abc/?   : bool(false)
---> http://::?   : NULL
---> http://::#   : NULL
---> x://::6.5   : NULL
---> http://?:/   : string(1) "/"
---> http://@?:/   : string(1) "/"
+--> x://::abc/?   : string(5) ":abc/"
+--> http://::?   : string(1) ":"
+--> http://::#   : string(1) ":"
+--> x://::6.5   : string(4) ":6.5"
+--> http://?:/   : NULL
+--> http://@?:/   : NULL
 --> file:///:   : string(2) "/:"
---> file:///a:/   : string(3) "a:/"
+--> file:///a:/   : string(4) "/a:/"
 --> file:///ab:/   : string(5) "/ab:/"
---> file:///a:/   : string(3) "a:/"
---> file:///@:/   : string(3) "@:/"
+--> file:///@:/   : string(4) "/@:/"
 --> file:///:80/   : string(5) "/:80/"
---> []   : string(2) "[]"
---> http://[x:80]/   : string(1) "/"
--->    : string(0) ""
+--> []   : NULL
+--> http://[x:80]/   : NULL
+-->    : NULL
 --> /   : string(1) "/"
 --> /rest/Users?filter={"id":"123"}   : string(11) "/rest/Users"
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> http:///blah.com   : string(9) "/blah.com"
+--> http://:80   : NULL
+--> http://user@:80   : NULL
+--> http://user:pass@:80   : NULL
+--> http://:   : NULL
+--> http://@/   : string(1) "/"
+--> http://@:/   : string(1) "/"
+--> http://:/   : string(1) "/"
+--> http://?   : NULL
+--> http://#   : NULL
+--> http://?:   : NULL
+--> http://:?   : NULL
+--> http://blah.com:123456   : NULL
+--> http://blah.com:abcdef   : string(6) "abcdef"
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(25) "@www.php.net:80/index.php"
+--> http://user:@pass@host/path?argument?value#etc   : string(10) "@host/path"
+--> http://foo.com\@bar.com   : NULL
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_008.phpt b/ext/standard/tests/url/parse_url_basic_008.phpt
index 21ead3b72c8a..ab819cd35a8c 100644
--- a/ext/standard/tests/url/parse_url_basic_008.phpt
+++ b/ext/standard/tests/url/parse_url_basic_008.phpt
@@ -34,7 +34,7 @@ echo "Done";
 --> www.php.net/   : NULL
 --> http://www.php.net   : NULL
 --> http://www.php.net/   : NULL
---> www.php.net:80   : NULL
+--> www.php.net:80/   : NULL
 --> http://www.php.net:80   : NULL
 --> http://www.php.net:80/   : NULL
 --> http://www.php.net/index.php   : NULL
@@ -47,7 +47,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : string(37) "lots=1&of=2&parameters=3&too=4&here=5"
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : NULL
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory/   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : NULL
@@ -92,38 +91,37 @@ echo "Done";
 --> http://x:?   : NULL
 --> x:blah.com   : NULL
 --> x:/blah.com   : NULL
---> x://::abc/?   : bool(false)
+--> x://::abc/?   : NULL
 --> http://::?   : NULL
 --> http://::#   : NULL
 --> x://::6.5   : NULL
---> http://?:/   : NULL
---> http://@?:/   : NULL
+--> http://?:/   : string(2) ":/"
+--> http://@?:/   : string(2) ":/"
 --> file:///:   : NULL
 --> file:///a:/   : NULL
 --> file:///ab:/   : NULL
---> file:///a:/   : NULL
 --> file:///@:/   : NULL
 --> file:///:80/   : NULL
 --> []   : NULL
 --> http://[x:80]/   : NULL
 -->    : NULL
 --> /   : NULL
---> /rest/Users?filter={"id":"123"}   : string(19) "filter={"id":"123"}"
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> /rest/Users?filter={"id":"123"}   : string(7) "filter="
+--> http:///blah.com   : NULL
+--> http://:80   : NULL
+--> http://user@:80   : NULL
+--> http://user:pass@:80   : NULL
+--> http://:   : NULL
+--> http://@/   : NULL
+--> http://@:/   : NULL
+--> http://:/   : NULL
+--> http://?   : NULL
+--> http://#   : NULL
+--> http://?:   : string(1) ":"
+--> http://:?   : NULL
+--> http://blah.com:123456   : NULL
+--> http://blah.com:abcdef   : NULL
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(31) "test=1&test2=char&test3=mixesCI"
+--> http://user:@pass@host/path?argument?value#etc   : string(14) "argument?value"
+--> http://foo.com\@bar.com   : NULL
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_009.phpt b/ext/standard/tests/url/parse_url_basic_009.phpt
index 29e8312d1ba0..591fdf0ca920 100644
--- a/ext/standard/tests/url/parse_url_basic_009.phpt
+++ b/ext/standard/tests/url/parse_url_basic_009.phpt
@@ -34,7 +34,7 @@ echo "Done";
 --> www.php.net/   : NULL
 --> http://www.php.net   : NULL
 --> http://www.php.net/   : NULL
---> www.php.net:80   : NULL
+--> www.php.net:80/   : NULL
 --> http://www.php.net:80   : NULL
 --> http://www.php.net:80/   : NULL
 --> http://www.php.net/index.php   : NULL
@@ -47,7 +47,6 @@ echo "Done";
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/   : NULL
---> http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory   : NULL
 --> http://www.php.net:80/this/../a/../deep/directory/   : NULL
 --> http://www.php.net:80/this/is/a/very/deep/directory/../file.php   : NULL
@@ -92,7 +91,7 @@ echo "Done";
 --> http://x:?   : NULL
 --> x:blah.com   : NULL
 --> x:/blah.com   : NULL
---> x://::abc/?   : bool(false)
+--> x://::abc/?   : NULL
 --> http://::?   : NULL
 --> http://::#   : NULL
 --> x://::6.5   : NULL
@@ -101,7 +100,6 @@ echo "Done";
 --> file:///:   : NULL
 --> file:///a:/   : NULL
 --> file:///ab:/   : NULL
---> file:///a:/   : NULL
 --> file:///@:/   : NULL
 --> file:///:80/   : NULL
 --> []   : NULL
@@ -109,21 +107,21 @@ echo "Done";
 -->    : NULL
 --> /   : NULL
 --> /rest/Users?filter={"id":"123"}   : NULL
---> http:///blah.com   : bool(false)
---> http://:80   : bool(false)
---> http://user@:80   : bool(false)
---> http://user:pass@:80   : bool(false)
---> http://:   : bool(false)
---> http://@/   : bool(false)
---> http://@:/   : bool(false)
---> http://:/   : bool(false)
---> http://?   : bool(false)
---> http://#   : bool(false)
---> http://?:   : bool(false)
---> http://:?   : bool(false)
---> http://blah.com:123456   : bool(false)
---> http://blah.com:abcdef   : bool(false)
---> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : bool(false)
---> http://user:@pass@host/path?argument?value#etc   : bool(false)
---> http://foo.com\@bar.com   : bool(false)
+--> http:///blah.com   : NULL
+--> http://:80   : NULL
+--> http://user@:80   : NULL
+--> http://user:pass@:80   : NULL
+--> http://:   : NULL
+--> http://@/   : NULL
+--> http://@:/   : NULL
+--> http://:/   : NULL
+--> http://?   : NULL
+--> http://#   : NULL
+--> http://?:   : NULL
+--> http://:?   : NULL
+--> http://blah.com:123456   : NULL
+--> http://blah.com:abcdef   : NULL
+--> http://secret@hideout@www.php.net:80/index.php?test=1&test2=char&test3=mixesCI#some_page_ref123   : string(16) "some_page_ref123"
+--> http://user:@pass@host/path?argument?value#etc   : string(3) "etc"
+--> http://foo.com\@bar.com   : NULL
 Done
diff --git a/ext/standard/tests/url/parse_url_basic_010.phpt b/ext/standard/tests/url/parse_url_basic_010.phpt
index 3bb2dba14254..a34b86b17bd1 100644
--- a/ext/standard/tests/url/parse_url_basic_010.phpt
+++ b/ext/standard/tests/url/parse_url_basic_010.phpt
@@ -28,4 +28,4 @@ PHP_URL_PASS: 4
 PHP_URL_PATH: 5 
 PHP_URL_QUERY: 6 
 PHP_URL_FRAGMENT: 7 
-Done
\ No newline at end of file
+Done
diff --git a/ext/standard/tests/url/parse_url_error_002.phpt b/ext/standard/tests/url/parse_url_error_002.phpt
index 45c20f410d9c..324e12965a30 100644
--- a/ext/standard/tests/url/parse_url_error_002.phpt
+++ b/ext/standard/tests/url/parse_url_error_002.phpt
@@ -43,5 +43,5 @@ echo "Done"
 
 --> Above range:
 Warning: parse_url(): Invalid URL component identifier 99 in %s on line 15
-bool(false)
-Done
\ No newline at end of file
+NULL
+Done
diff --git a/ext/standard/tests/url/parse_url_variation_001.phpt b/ext/standard/tests/url/parse_url_variation_001.phpt
index 0b804eed579a..784308b0e4a0 100644
--- a/ext/standard/tests/url/parse_url_variation_001.phpt
+++ b/ext/standard/tests/url/parse_url_variation_001.phpt
@@ -160,16 +160,10 @@ Error: 2 - parse_url() expects parameter 1 to be string, array given, %s(70)
 NULL
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
+NULL
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
+NULL
 
 Arg value 1 
 array(1) {
@@ -178,10 +172,7 @@ array(1) {
 }
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
+NULL
 
 Arg value 1 
 array(1) {
@@ -190,22 +181,13 @@ array(1) {
 }
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
+NULL
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
+NULL
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
+NULL
 Error: 4096 - Object of class stdClass could not be converted to string, %s(69)
 
 Arg value  
@@ -213,14 +195,8 @@ Error: 2 - parse_url() expects parameter 1 to be string, object given, %s(70)
 NULL
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
+NULL
 
 Arg value  
-array(1) {
-  ["path"]=>
-  string(0) ""
-}
-Done
\ No newline at end of file
+NULL
+Done
diff --git a/ext/standard/tests/url/parse_url_variation_002_32bit.phpt b/ext/standard/tests/url/parse_url_variation_002_32bit.phpt
index b03393ea8ed2..a87de10d1e25 100644
--- a/ext/standard/tests/url/parse_url_variation_002_32bit.phpt
+++ b/ext/standard/tests/url/parse_url_variation_002_32bit.phpt
@@ -85,7 +85,7 @@ Error: 8 - Undefined variable: unset_var, %s(%d)
 
 Arg value 10.5 
 Error: 2 - parse_url(): Invalid URL component identifier 10, %s(%d)
-bool(false)
+NULL
 
 Arg value -10.5 
 array(8) {
@@ -186,4 +186,4 @@ string(4) "http"
 
 Arg value  
 string(4) "http"
-Done
\ No newline at end of file
+Done
diff --git a/ext/standard/tests/url/parse_url_variation_002_64bit.phpt b/ext/standard/tests/url/parse_url_variation_002_64bit.phpt
index 1c24e1f72791..33b6bf031b4a 100644
--- a/ext/standard/tests/url/parse_url_variation_002_64bit.phpt
+++ b/ext/standard/tests/url/parse_url_variation_002_64bit.phpt
@@ -85,7 +85,7 @@ Error: 8 - Undefined variable: unset_var, %s(64)
 
 Arg value 10.5 
 Error: 2 - parse_url(): Invalid URL component identifier 10, %s(71)
-bool(false)
+NULL
 
 Arg value -10.5 
 array(8) {
@@ -109,7 +109,7 @@ array(8) {
 
 Arg value 101234567000 
 Error: 2 - parse_url(): Invalid URL component identifier %d, %s(71)
-bool(false)
+NULL
 
 Arg value 1.07654321E-9 
 string(4) "http"
@@ -186,4 +186,4 @@ string(4) "http"
 
 Arg value  
 string(4) "http"
-Done
\ No newline at end of file
+Done
diff --git a/ext/standard/tests/url/urls.inc b/ext/standard/tests/url/urls.inc
index c99424425689..53eccf1ee0f4 100644
--- a/ext/standard/tests/url/urls.inc
+++ b/ext/standard/tests/url/urls.inc
@@ -14,7 +14,7 @@ $urls = array(
 'www.php.net/',
 'http://www.php.net',
 'http://www.php.net/',
-'www.php.net:80',
+'www.php.net:80/',
 'http://www.php.net:80',
 'http://www.php.net:80/',
 'http://www.php.net/index.php',
@@ -27,7 +27,6 @@ $urls = array(
 'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php',
 'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php?lots=1&of=2&parameters=3&too=4&here=5',
 'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/',
-'http://www.php.net:80/this/is/a/very/deep/directory/structure/and/file.php',
 'http://www.php.net:80/this/../a/../deep/directory',
 'http://www.php.net:80/this/../a/../deep/directory/',
 'http://www.php.net:80/this/is/a/very/deep/directory/../file.php',
@@ -81,7 +80,6 @@ $urls = array(
 'file:///:',
 'file:///a:/',
 'file:///ab:/',
-'file:///a:/',
 'file:///@:/',
 'file:///:80/',
 '[]',
@@ -89,8 +87,6 @@ $urls = array(
 '',
 '/',
 '/rest/Users?filter={"id":"123"}',
-
-// Severely malformed URLs that do not parse:
 'http:///blah.com',
 'http://:80',
 'http://user@:80',
diff --git a/ext/standard/url.c b/ext/standard/url.c
index a33ff9ae82cb..f0524aa8972a 100644
--- a/ext/standard/url.c
+++ b/ext/standard/url.c
@@ -25,6 +25,7 @@
 #include "php.h"
 
 #include "url.h"
+#include "url_parser_ex.h"
 #include "file.h"
 #ifdef _OSD_POSIX
 #ifndef APACHE
@@ -37,352 +38,37 @@
 #endif /*APACHE*/
 #endif /*_OSD_POSIX*/
 
-/* {{{ free_url
- */
-PHPAPI void php_url_free(php_url *theurl)
-{
-	if (theurl->scheme)
-		efree(theurl->scheme);
-	if (theurl->user)
-		efree(theurl->user);
-	if (theurl->pass)
-		efree(theurl->pass);
-	if (theurl->host)
-		efree(theurl->host);
-	if (theurl->path)
-		efree(theurl->path);
-	if (theurl->query)
-		efree(theurl->query);
-	if (theurl->fragment)
-		efree(theurl->fragment);
-	efree(theurl);
-}
-/* }}} */
+ZEND_DECLARE_MODULE_GLOBALS(url)
 
-/* {{{ php_replace_controlchars
- */
-PHPAPI char *php_replace_controlchars_ex(char *str, size_t len)
+PHPAPI php_url *php_url_parse_ex (const char *str, int length)
 {
-	unsigned char *s = (unsigned char *)str;
-	unsigned char *e = (unsigned char *)str + len;
-
-	if (!str) {
-		return (NULL);
-	}
+	php_url *url = (php_url*) ecalloc (1, sizeof(php_url));
+	URLG(url_str) = str;
 
-	while (s < e) {
+	url_parse_scheme(url);
+	url_parse_authority(url);
+	url_parse_path(url);
+	url_parse_query_frag(url);
 
-		if (iscntrl(*s)) {
-			*s='_';
-		}
-		s++;
-	}
-
-	return (str);
+	return url;
 }
-/* }}} */
 
-PHPAPI char *php_replace_controlchars(char *str)
-{
-	return php_replace_controlchars_ex(str, strlen(str));
-}
-
-PHPAPI php_url *php_url_parse(char const *str)
+PHPAPI php_url *php_url_parse (const char *str)
 {
 	return php_url_parse_ex(str, strlen(str));
 }
 
-/* {{{ php_url_parse
- */
-PHPAPI php_url *php_url_parse_ex(char const *str, size_t length)
+PHPAPI void php_url_free (php_url *url)
 {
-	char port_buf[6];
-	php_url *ret = ecalloc(1, sizeof(php_url));
-	char const *s, *e, *p, *pp, *ue;
-
-	s = str;
-	ue = s + length;
-
-	/* parse scheme */
-	if ((e = memchr(s, ':', length)) && (e - s)) {
-		/* validate scheme */
-		p = s;
-		while (p < e) {
-			/* scheme = 1*[ lowalpha | digit | "+" | "-" | "." ] */
-			if (!isalpha(*p) && !isdigit(*p) && *p != '+' && *p != '.' && *p != '-') {
-				if (e + 1 < ue && e < s + strcspn(s, "?#")) {
-					goto parse_port;
-				} else {
-					goto just_path;
-				}
-			}
-			p++;
-		}
-
-		if (*(e + 1) == '\0') { /* only scheme is available */
-			ret->scheme = estrndup(s, (e - s));
-			php_replace_controlchars_ex(ret->scheme, (e - s));
-			goto end;
-		}
-
-		/*
-		 * certain schemas like mailto: and zlib: may not have any / after them
-		 * this check ensures we support those.
-		 */
-		if (*(e+1) != '/') {
-			/* check if the data we get is a port this allows us to
-			 * correctly parse things like a.com:80
-			 */
-			p = e + 1;
-			while (isdigit(*p)) {
-				p++;
-			}
-
-			if ((*p == '\0' || *p == '/') && (p - e) < 7) {
-				goto parse_port;
-			}
-
-			ret->scheme = estrndup(s, (e-s));
-			php_replace_controlchars_ex(ret->scheme, (e - s));
-
-			length -= ++e - s;
-			s = e;
-			goto just_path;
-		} else {
-			ret->scheme = estrndup(s, (e-s));
-			php_replace_controlchars_ex(ret->scheme, (e - s));
-
-			if (*(e+2) == '/') {
-				s = e + 3;
-				if (!strncasecmp("file", ret->scheme, sizeof("file"))) {
-					if (*(e + 3) == '/') {
-						/* support windows drive letters as in:
-						   file:///c:/somedir/file.txt
-						*/
-						if (*(e + 5) == ':') {
-							s = e + 4;
-						}
-						goto nohost;
-					}
-				}
-			} else {
-				if (!strncasecmp("file", ret->scheme, sizeof("file"))) {
-					s = e + 1;
-					goto nohost;
-				} else {
-					length -= ++e - s;
-					s = e;
-					goto just_path;
-				}
-			}
-		}
-	} else if (e) { /* no scheme; starts with colon: look for port */
-		parse_port:
-		p = e + 1;
-		pp = p;
-
-		while (pp-p < 6 && isdigit(*pp)) {
-			pp++;
-		}
-
-		if (pp - p > 0 && pp - p < 6 && (*pp == '/' || *pp == '\0')) {
-			zend_long port;
-			memcpy(port_buf, p, (pp - p));
-			port_buf[pp - p] = '\0';
-			port = ZEND_STRTOL(port_buf, NULL, 10);
-			if (port > 0 && port <= 65535) {
-				ret->port = (unsigned short) port;
-				if (*s == '/' && *(s + 1) == '/') { /* relative-scheme URL */
-				    s += 2;
-				}
-			} else {
-				if (ret->scheme) efree(ret->scheme);
-				efree(ret);
-				return NULL;
-			}
-		} else if (p == pp && *pp == '\0') {
-			if (ret->scheme) efree(ret->scheme);
-			efree(ret);
-			return NULL;
-		} else if (*s == '/' && *(s + 1) == '/') { /* relative-scheme URL */
-			s += 2;
-		} else {
-			goto just_path;
-		}
-	} else if (*s == '/' && *(s + 1) == '/') { /* relative-scheme URL */
-		s += 2;
-	} else {
-		just_path:
-		ue = s + length;
-		goto nohost;
-	}
-
-	e = ue;
-
-	if (!(p = memchr(s, '/', (ue - s)))) {
-		char *query, *fragment;
-
-		query = memchr(s, '?', (ue - s));
-		fragment = memchr(s, '#', (ue - s));
-
-		if (query && fragment) {
-			if (query > fragment) {
-				e = fragment;
-			} else {
-				e = query;
-			}
-		} else if (query) {
-			e = query;
-		} else if (fragment) {
-			e = fragment;
-		}
-	} else {
-		e = p;
-	}
-
-	/* check for login and password */
-	if ((p = zend_memrchr(s, '@', (e-s)))) {
-		/* check for invalid chars inside login/pass */
-		pp = s;
-		while (pp < p) {
-			/* http://www.rfc-editor.org/rfc/rfc3986.txt §3.2.1 */
-			const char search_rfc3986[] = ":;=!$%_-.~&'()*+,";
-			if (!isalnum(*pp) && !strchr(search_rfc3986, *pp)) {
-				if (ret->scheme) {
-					efree(ret->scheme);
-				}
-				efree(ret);
-				return NULL;
-			}
-			pp++;
-		}
-
-		if ((pp = memchr(s, ':', (p-s)))) {
-			ret->user = estrndup(s, (pp-s));
-			php_replace_controlchars_ex(ret->user, (pp - s));
-
-			pp++;
-			ret->pass = estrndup(pp, (p-pp));
-			php_replace_controlchars_ex(ret->pass, (p-pp));
-		} else {
-			ret->user = estrndup(s, (p-s));
-			php_replace_controlchars_ex(ret->user, (p-s));
-		}
-
-		s = p + 1;
-	}
-
-	/* check for port */
-	if (*s == '[' && *(e-1) == ']') {
-		/* Short circuit portscan,
-		   we're dealing with an
-		   IPv6 embedded address */
-		p = s;
-	} else {
-		/* memrchr is a GNU specific extension
-		   Emulate for wide compatibility */
-		for(p = e; p >= s && *p != ':'; p--);
-	}
-
-	if (p >= s && *p == ':') {
-		if (!ret->port) {
-			p++;
-			if (e-p > 5) { /* port cannot be longer then 5 characters */
-				if (ret->scheme) efree(ret->scheme);
-				if (ret->user) efree(ret->user);
-				if (ret->pass) efree(ret->pass);
-				efree(ret);
-				return NULL;
-			} else if (e - p > 0) {
-				zend_long port;
-				memcpy(port_buf, p, (e - p));
-				port_buf[e - p] = '\0';
-				port = ZEND_STRTOL(port_buf, NULL, 10);
-				if (port > 0 && port <= 65535) {
-					ret->port = (unsigned short)port;
-				} else {
-					if (ret->scheme) efree(ret->scheme);
-					if (ret->user) efree(ret->user);
-					if (ret->pass) efree(ret->pass);
-					efree(ret);
-					return NULL;
-				}
-			}
-			p--;
-		}
-	} else {
-		p = e;
-	}
-
-	/* check if we have a valid host, if we don't reject the string as url */
-	if ((p-s) < 1) {
-		if (ret->scheme) efree(ret->scheme);
-		if (ret->user) efree(ret->user);
-		if (ret->pass) efree(ret->pass);
-		efree(ret);
-		return NULL;
-	}
-
-	ret->host = estrndup(s, (p-s));
-	php_replace_controlchars_ex(ret->host, (p - s));
-
-	if (e == ue) {
-		return ret;
-	}
-
-	s = e;
-
-	nohost:
-
-	if ((p = memchr(s, '?', (ue - s)))) {
-		pp = memchr(s, '#', (ue - s));
-
-		if (pp && pp < p) {
-			if (pp - s) {
-				ret->path = estrndup(s, (pp-s));
-				php_replace_controlchars_ex(ret->path, (pp - s));
-			}
-			p = pp;
-			goto label_parse;
-		}
-
-		if (p - s) {
-			ret->path = estrndup(s, (p-s));
-			php_replace_controlchars_ex(ret->path, (p - s));
-		}
-
-		if (pp) {
-			if (pp - ++p) {
-				ret->query = estrndup(p, (pp-p));
-				php_replace_controlchars_ex(ret->query, (pp - p));
-			}
-			p = pp;
-			goto label_parse;
-		} else if (++p - ue) {
-			ret->query = estrndup(p, (ue-p));
-			php_replace_controlchars_ex(ret->query, (ue - p));
-		}
-	} else if ((p = memchr(s, '#', (ue - s)))) {
-		if (p - s) {
-			ret->path = estrndup(s, (p-s));
-			php_replace_controlchars_ex(ret->path, (p - s));
-		}
-
-		label_parse:
-		p++;
-
-		if (ue - p) {
-			ret->fragment = estrndup(p, (ue-p));
-			php_replace_controlchars_ex(ret->fragment, (ue - p));
-		}
-	} else {
-		ret->path = estrndup(s, (ue-s));
-		php_replace_controlchars_ex(ret->path, (ue - s));
-	}
-end:
-	return ret;
+	if (url->scheme) efree(url->scheme);
+	if (url->user) efree(url->user);
+	if (url->pass) efree(url->pass);
+	if (url->host) efree(url->host);
+	if (url->path) efree(url->path);
+	if (url->query) efree(url->query);
+	if (url->fragment) efree(url->fragment);
+	efree(url);
 }
-/* }}} */
 
 /* {{{ proto mixed parse_url(string url, [int url_component])
    Parse a URL and return its components */
@@ -397,11 +83,7 @@ PHP_FUNCTION(parse_url)
 		return;
 	}
 
-	resource = php_url_parse_ex(str, str_len);
-	if (resource == NULL) {
-		/* @todo Find a method to determine why php_url_parse_ex() failed */
-		RETURN_FALSE;
-	}
+	resource = php_url_parse(str);
 
 	if (key > -1) {
 		switch (key) {
@@ -431,7 +113,7 @@ PHP_FUNCTION(parse_url)
 				break;
 			default:
 				php_error_docref(NULL, E_WARNING, "Invalid URL component identifier " ZEND_LONG_FMT, key);
-				RETVAL_FALSE;
+				RETVAL_NULL();
 		}
 		goto done;
 	}
@@ -439,7 +121,7 @@ PHP_FUNCTION(parse_url)
 	/* allocate an array for return */
 	array_init(return_value);
 
-    /* add the various elements to the array */
+	/* add the various elements to the array */
 	if (resource->scheme != NULL)
 		add_assoc_string(return_value, "scheme", resource->scheme);
 	if (resource->host != NULL)
@@ -456,6 +138,12 @@ PHP_FUNCTION(parse_url)
 		add_assoc_string(return_value, "query", resource->query);
 	if (resource->fragment != NULL)
 		add_assoc_string(return_value, "fragment", resource->fragment);
+
+	if (UNEXPECTED(!zend_array_count(HASH_OF(return_value)))) {
+		efree(Z_ARRVAL_P(return_value));
+		RETVAL_NULL();
+	}
+
 done:
 	php_url_free(resource);
 }
@@ -807,6 +495,6 @@ PHP_FUNCTION(get_headers)
  * tab-width: 4
  * c-basic-offset: 4
  * End:
- * vim600: sw=4 ts=4 fdm=marker
- * vim<600: sw=4 ts=4
+ * vim600: sw=4 ts=4 fdm=marker noet
+ * vim<600: sw=4 ts=4 noet
  */
diff --git a/ext/standard/url.h b/ext/standard/url.h
index 864ba8b3ac56..6c0057e41690 100644
--- a/ext/standard/url.h
+++ b/ext/standard/url.h
@@ -19,26 +19,27 @@
 
 #ifndef URL_H
 #define URL_H
+#include "zend_globals.h"
 
-typedef struct php_url {
-	char *scheme;
-	char *user;
-	char *pass;
-	char *host;
-	unsigned short port;
-	char *path;
-	char *query;
-	char *fragment;
+typedef struct _php_url {
+  char *scheme;
+  char *user;
+  char *pass;
+  char *host;
+  unsigned int port;
+  char *path;
+  char *query;
+  char *fragment;
 } php_url;
 
-PHPAPI void php_url_free(php_url *theurl);
+PHPAPI void php_url_free(php_url *url);
 PHPAPI php_url *php_url_parse(char const *str);
-PHPAPI php_url *php_url_parse_ex(char const *str, size_t length);
+PHPAPI php_url *php_url_parse_ex(char const *str, int length);
+
 PHPAPI size_t php_url_decode(char *str, size_t len); /* return value: length of decoded string */
 PHPAPI size_t php_raw_url_decode(char *str, size_t len); /* return value: length of decoded string */
 PHPAPI zend_string *php_url_encode(char const *s, size_t len);
 PHPAPI zend_string *php_raw_url_encode(char const *s, size_t len);
-PHPAPI char *php_replace_controlchars_ex(char *str, size_t len);
 
 PHP_FUNCTION(parse_url);
 PHP_FUNCTION(urlencode);
@@ -59,6 +60,11 @@ PHP_FUNCTION(get_headers);
 #define PHP_QUERY_RFC1738 1
 #define PHP_QUERY_RFC3986 2
 
+ZEND_BEGIN_MODULE_GLOBALS(url)
+	const char* url_str;
+ZEND_END_MODULE_GLOBALS(url)
+#define URLG(v) ZEND_MODULE_GLOBALS_ACCESSOR(url, v)
+
 #endif /* URL_H */
 
 /*
diff --git a/ext/standard/url_parser_ex.c b/ext/standard/url_parser_ex.c
new file mode 100644
index 000000000000..45ccd6b9a8d1
--- /dev/null
+++ b/ext/standard/url_parser_ex.c
@@ -0,0 +1,4012 @@
+/* Generated by re2c 0.16 */
+#line 1 "ext/standard/url_parser_ex.re"
+/*
+   +----------------------------------------------------------------------+
+   | PHP Version 7                                                        |
+   +----------------------------------------------------------------------+
+   | Copyright (c) 1997-2016 The PHP Group                                |
+   +----------------------------------------------------------------------+
+   | This source file is subject to version 3.01 of the PHP license,      |
+   | that is bundled with this package in the file LICENSE, and is        |
+   | available through the world-wide-web at the following url:           |
+   | http://www.php.net/license/3_01.txt                                  |
+   | If you did not receive a copy of the PHP license and are unable to   |
+   | obtain it through the world-wide-web, please send a note to          |
+   | license@php.net so we can mail you a copy immediately.               |
+   +----------------------------------------------------------------------+
+ */
+
+/**
+ * Url Parser used from https://github.com/staskobzar/url_parser_re2c
+ * Licensed under MIT License.
+ *
+ * Modified for more correct RFC 3986 requirements & PHP
+ */
+
+#include <stdlib.h>
+#include <signal.h>
+#include <string.h>
+#include <ctype.h>
+#include <sys/types.h>
+
+#include "php.h"
+#include "url.h"
+#include "url_parser_ex.h"
+
+ZEND_DECLARE_MODULE_GLOBALS(url)
+
+/* Since YYMARKER increments on wildcards, we'll track ourselves. */
+const char *marker;
+const char *YYMARKER;
+
+char* get_token(int len)
+{
+    char *res = (char *) emalloc (len + 1);
+    int i = 0;
+    for (; i < len; i++) res[i] = marker[i];
+    res[i] = '\0';
+    return res;
+}
+
+#line 64 "ext/standard/url_parser_ex.re"
+
+
+void url_parse_scheme(php_url *url)
+{
+    marker = URLG(url_str);
+
+#line 59 "ext/standard/url_parser_ex.c"
+{
+	unsigned char yych;
+	static const unsigned char yybm[] = {
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0, 128, 128, 128, 128,   0, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128,   0,   0,   0,   0,   0,   0, 
+		  0, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0,   0,   0, 
+		  0, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+	};
+	yych = *(YYMARKER = URLG(url_str));
+	if (yych <= 'Z') {
+		if (yych <= 0x00) goto yy3;
+		if (yych >= 'A') goto yy5;
+	} else {
+		if (yych <= '`') goto yy2;
+		if (yych <= 'z') goto yy5;
+	}
+yy2:
+#line 73 "ext/standard/url_parser_ex.re"
+	{ return; }
+#line 107 "ext/standard/url_parser_ex.c"
+yy3:
+	++URLG(url_str);
+#line 72 "ext/standard/url_parser_ex.re"
+	{ URLG(url_str)--; return; }
+#line 112 "ext/standard/url_parser_ex.c"
+yy5:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yybm[0+yych] & 128) {
+		goto yy5;
+	}
+	if (yych <= '/') goto yy7;
+	if (yych <= ':') goto yy8;
+yy7:
+	URLG(url_str) = YYMARKER;
+	goto yy2;
+yy8:
+	++URLG(url_str);
+#line 74 "ext/standard/url_parser_ex.re"
+	{
+        int len = URLG(url_str) - marker - 1;
+        url->scheme = get_token(len);
+        return;
+    }
+#line 132 "ext/standard/url_parser_ex.c"
+}
+#line 79 "ext/standard/url_parser_ex.re"
+
+}
+
+void url_parse_authority_userinfo (php_url *url)
+{
+    marker = URLG(url_str);
+
+#line 142 "ext/standard/url_parser_ex.c"
+{
+	unsigned char yych;
+	static const unsigned char yybm[] = {
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0, 128,   0,   0, 128,   0, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128,   0, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128,   0, 128,   0,   0, 
+		  0, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0,   0, 128, 
+		  0, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0, 128,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+	};
+	yych = *(YYMARKER = URLG(url_str));
+	if (yybm[0+yych] & 128) {
+		goto yy15;
+	}
+	if (yych <= '%') {
+		if (yych <= 0x00) goto yy13;
+		if (yych >= '$') goto yy18;
+	} else {
+		if (yych == '@') goto yy19;
+	}
+yy12:
+#line 89 "ext/standard/url_parser_ex.re"
+	{ return; }
+#line 192 "ext/standard/url_parser_ex.c"
+yy13:
+	++URLG(url_str);
+#line 88 "ext/standard/url_parser_ex.re"
+	{ URLG(url_str)--; return; }
+#line 197 "ext/standard/url_parser_ex.c"
+yy15:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yybm[0+yych] & 128) {
+		goto yy15;
+	}
+	if (yych <= '#') goto yy17;
+	if (yych <= '%') goto yy18;
+	if (yych == '@') goto yy19;
+yy17:
+	URLG(url_str) = YYMARKER;
+	goto yy12;
+yy18:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy17;
+		if (yych <= '9') goto yy21;
+		goto yy17;
+	} else {
+		if (yych <= 'F') goto yy21;
+		if (yych <= '`') goto yy17;
+		if (yych <= 'f') goto yy21;
+		goto yy17;
+	}
+yy19:
+	++URLG(url_str);
+#line 90 "ext/standard/url_parser_ex.re"
+	{
+        int len = 0;
+        len = URLG(url_str) - marker;
+
+        char* split = memchr(marker, ':', len);
+        if (split && split < URLG(url_str)) {
+            len = split - marker;
+            if (len > 0) url->user = get_token(len);
+            marker += len + 1;
+            len = URLG(url_str) - split - 2;
+            if (len > 0) url->pass = get_token(len);
+            return;
+        } else {
+            int len = URLG(url_str) - marker - 1;
+            if (len > 0) url->user = get_token(len);
+            return;
+        }
+    }
+#line 244 "ext/standard/url_parser_ex.c"
+yy21:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy17;
+		if (yych <= '9') goto yy15;
+		goto yy17;
+	} else {
+		if (yych <= 'F') goto yy15;
+		if (yych <= '`') goto yy17;
+		if (yych <= 'f') goto yy15;
+		goto yy17;
+	}
+}
+#line 108 "ext/standard/url_parser_ex.re"
+
+}
+
+void url_parse_authority_host (php_url *url)
+{
+    marker = URLG(url_str);
+
+#line 267 "ext/standard/url_parser_ex.c"
+{
+	unsigned char yych;
+	unsigned int yyaccept = 0;
+	static const unsigned char yybm[] = {
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,  80,   0,   0,  80,   0,  80,  80, 
+		 80,  80,  80,  80,  80,  80,  80,   0, 
+		240, 240, 240, 240, 240, 240, 240, 240, 
+		240, 240,  64,  80,   0,  80,   0,   0, 
+		  0, 240, 240, 240, 240, 240, 240, 208, 
+		208, 208, 208, 208, 208, 208, 208, 208, 
+		208, 208, 208, 208, 208, 208, 208, 208, 
+		208, 208, 208,   0,   0,   0,   0,  80, 
+		  0, 240, 240, 240, 240, 240, 240, 208, 
+		208, 208, 208, 208, 208, 208, 208, 208, 
+		208, 208, 208, 208, 208, 208, 208, 208, 
+		208, 208, 208,   0,   0,   0,  80,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+	};
+	yych = *(YYMARKER = URLG(url_str));
+	if (yybm[0+yych] & 16) {
+		goto yy27;
+	}
+	if (yych <= '%') {
+		if (yych <= 0x00) goto yy25;
+		if (yych >= '$') goto yy30;
+	} else {
+		if (yych <= '@') goto yy24;
+		if (yych <= '[') goto yy32;
+	}
+yy24:
+#line 137 "ext/standard/url_parser_ex.re"
+	{ return; }
+#line 319 "ext/standard/url_parser_ex.c"
+yy25:
+	++URLG(url_str);
+#line 136 "ext/standard/url_parser_ex.re"
+	{ URLG(url_str) = marker; return; }
+#line 324 "ext/standard/url_parser_ex.c"
+yy27:
+	yyaccept = 1;
+	YYMARKER = ++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yybm[0+yych] & 16) {
+		goto yy27;
+	}
+	if (yych <= '#') goto yy29;
+	if (yych <= '%') goto yy30;
+yy29:
+#line 138 "ext/standard/url_parser_ex.re"
+	{
+        goto host;
+    }
+#line 339 "ext/standard/url_parser_ex.c"
+yy30:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy33;
+	} else {
+		if (yych <= 'F') goto yy33;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy33;
+	}
+yy31:
+	URLG(url_str) = YYMARKER;
+	if (yyaccept == 0) {
+		goto yy24;
+	} else {
+		goto yy29;
+	}
+yy32:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy34;
+		} else {
+			if (yych <= ':') goto yy35;
+			if (yych <= '@') goto yy31;
+			goto yy34;
+		}
+	} else {
+		if (yych <= 'f') {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'e') goto yy34;
+			goto yy36;
+		} else {
+			if (yych == 'v') goto yy37;
+			goto yy31;
+		}
+	}
+yy33:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy27;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy27;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy27;
+		goto yy31;
+	}
+yy34:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy38;
+		if (yych <= ':') goto yy39;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy38;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy38;
+		goto yy31;
+	}
+yy35:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy40;
+	goto yy31;
+yy36:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy38;
+		} else {
+			if (yych <= ':') goto yy39;
+			if (yych <= '@') goto yy31;
+			goto yy38;
+		}
+	} else {
+		if (yych <= 'd') {
+			if (yych <= '`') goto yy31;
+			goto yy38;
+		} else {
+			if (yych <= 'e') goto yy41;
+			if (yych <= 'f') goto yy38;
+			goto yy31;
+		}
+	}
+yy37:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy31;
+	goto yy43;
+yy38:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy44;
+		if (yych >= ';') goto yy31;
+	} else {
+		if (yych <= 'F') goto yy44;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy44;
+		goto yy31;
+	}
+yy39:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy45;
+		if (yych <= ':') goto yy46;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy45;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy45;
+		goto yy31;
+	}
+yy40:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '1') {
+			if (yych <= '/') goto yy31;
+			if (yych <= '0') goto yy47;
+			goto yy48;
+		} else {
+			if (yych <= '2') goto yy49;
+			if (yych <= '9') goto yy50;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy51;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'e') goto yy51;
+			if (yych <= 'f') goto yy54;
+			goto yy31;
+		}
+	}
+yy41:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '7') {
+			if (yych <= '/') goto yy31;
+			goto yy44;
+		} else {
+			if (yych <= '8') goto yy55;
+			if (yych <= '9') goto yy44;
+			goto yy39;
+		}
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy44;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy44;
+			goto yy31;
+		}
+	}
+yy42:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+yy43:
+	if (yybm[0+yych] & 32) {
+		goto yy42;
+	}
+	if (yych == '.') goto yy56;
+	goto yy31;
+yy44:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy57;
+		if (yych <= ':') goto yy39;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy57;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy57;
+		goto yy31;
+	}
+yy45:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy58;
+		if (yych <= ':') goto yy59;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy58;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy58;
+		goto yy31;
+	}
+yy46:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '1') {
+			if (yych <= '/') goto yy31;
+			if (yych <= '0') goto yy60;
+			goto yy61;
+		} else {
+			if (yych <= '2') goto yy62;
+			if (yych <= '9') goto yy63;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy64;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy64;
+			goto yy31;
+		}
+	}
+yy47:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy66;
+			if (yych <= ':') goto yy67;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy66;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy66;
+			goto yy31;
+		}
+	}
+yy48:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy68;
+			if (yych <= ':') goto yy67;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy66;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy66;
+			goto yy31;
+		}
+	}
+yy49:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '4') goto yy68;
+			if (yych <= '5') goto yy69;
+			if (yych <= '9') goto yy70;
+			goto yy67;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy66;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy66;
+			goto yy31;
+		}
+	}
+yy50:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy70;
+			if (yych <= ':') goto yy67;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy66;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy66;
+			goto yy31;
+		}
+	}
+yy51:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy66;
+		} else {
+			if (yych <= ':') goto yy67;
+			if (yych <= '@') goto yy31;
+			goto yy66;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy66;
+			goto yy31;
+		}
+	}
+yy52:
+	++URLG(url_str);
+#line 141 "ext/standard/url_parser_ex.re"
+	{
+        goto host;
+    }
+#line 678 "ext/standard/url_parser_ex.c"
+yy54:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy66;
+		} else {
+			if (yych <= ':') goto yy67;
+			if (yych <= '@') goto yy31;
+			goto yy66;
+		}
+	} else {
+		if (yych <= '`') {
+			if (yych == ']') goto yy52;
+			goto yy31;
+		} else {
+			if (yych <= 'e') goto yy66;
+			if (yych <= 'f') goto yy71;
+			goto yy31;
+		}
+	}
+yy55:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '0') goto yy72;
+		if (yych <= '9') goto yy57;
+		goto yy39;
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy57;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy57;
+			goto yy31;
+		}
+	}
+yy56:
+	yych = *++URLG(url_str);
+	if (yych == ']') goto yy31;
+	goto yy74;
+yy57:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy39;
+	goto yy31;
+yy58:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy75;
+		if (yych >= ';') goto yy31;
+	} else {
+		if (yych <= 'F') goto yy75;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy75;
+		goto yy31;
+	}
+yy59:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy76;
+		if (yych <= ':') goto yy77;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy76;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy76;
+		goto yy31;
+	}
+yy60:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy78;
+			if (yych <= ':') goto yy79;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy78;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy78;
+			goto yy31;
+		}
+	}
+yy61:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy80;
+			if (yych <= ':') goto yy79;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy78;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy78;
+			goto yy31;
+		}
+	}
+yy62:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '4') goto yy80;
+			if (yych <= '5') goto yy81;
+			if (yych <= '9') goto yy82;
+			goto yy79;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy78;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy78;
+			goto yy31;
+		}
+	}
+yy63:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy82;
+			if (yych <= ':') goto yy79;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy78;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy78;
+			goto yy31;
+		}
+	}
+yy64:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy78;
+		} else {
+			if (yych <= ':') goto yy79;
+			if (yych <= '@') goto yy31;
+			goto yy78;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy78;
+			goto yy31;
+		}
+	}
+yy65:
+	yych = *++URLG(url_str);
+	if (yych <= '1') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '0') goto yy83;
+		goto yy84;
+	} else {
+		if (yych <= '2') goto yy85;
+		if (yych <= '9') goto yy86;
+		goto yy31;
+	}
+yy66:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy87;
+		} else {
+			if (yych <= ':') goto yy67;
+			if (yych <= '@') goto yy31;
+			goto yy87;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy87;
+			goto yy31;
+		}
+	}
+yy67:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy64;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy64;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy64;
+		goto yy31;
+	}
+yy68:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy88;
+			if (yych <= ':') goto yy67;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy87;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy87;
+			goto yy31;
+		}
+	}
+yy69:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '5') goto yy88;
+			if (yych <= '9') goto yy87;
+			goto yy67;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy87;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy87;
+			goto yy31;
+		}
+	}
+yy70:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy87;
+			if (yych <= ':') goto yy67;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy87;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy87;
+			goto yy31;
+		}
+	}
+yy71:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy87;
+		} else {
+			if (yych <= ':') goto yy67;
+			if (yych <= '@') goto yy31;
+			goto yy87;
+		}
+	} else {
+		if (yych <= '`') {
+			if (yych == ']') goto yy52;
+			goto yy31;
+		} else {
+			if (yych <= 'e') goto yy87;
+			if (yych <= 'f') goto yy89;
+			goto yy31;
+		}
+	}
+yy72:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy90;
+	goto yy31;
+yy73:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+yy74:
+	if (yybm[0+yych] & 64) {
+		goto yy73;
+	}
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy75:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy91;
+		if (yych <= ':') goto yy59;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy91;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy91;
+		goto yy31;
+	}
+yy76:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy92;
+		if (yych <= ':') goto yy93;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy92;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy92;
+		goto yy31;
+	}
+yy77:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '1') {
+			if (yych <= '/') goto yy31;
+			if (yych <= '0') goto yy94;
+			goto yy95;
+		} else {
+			if (yych <= '2') goto yy96;
+			if (yych <= '9') goto yy97;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy98;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy98;
+			goto yy31;
+		}
+	}
+yy78:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy99;
+		} else {
+			if (yych <= ':') goto yy79;
+			if (yych <= '@') goto yy31;
+			goto yy99;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy99;
+			goto yy31;
+		}
+	}
+yy79:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy98;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy98;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy98;
+		goto yy31;
+	}
+yy80:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy100;
+			if (yych <= ':') goto yy79;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy99;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy99;
+			goto yy31;
+		}
+	}
+yy81:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '5') goto yy100;
+			if (yych <= '9') goto yy99;
+			goto yy79;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy99;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy99;
+			goto yy31;
+		}
+	}
+yy82:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy99;
+			if (yych <= ':') goto yy79;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy99;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy99;
+			goto yy31;
+		}
+	}
+yy83:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy101;
+	goto yy31;
+yy84:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy101;
+	if (yych <= '/') goto yy31;
+	if (yych <= '9') goto yy86;
+	goto yy31;
+yy85:
+	yych = *++URLG(url_str);
+	if (yych <= '/') {
+		if (yych == '.') goto yy101;
+		goto yy31;
+	} else {
+		if (yych <= '4') goto yy86;
+		if (yych <= '5') goto yy102;
+		if (yych <= '9') goto yy83;
+		goto yy31;
+	}
+yy86:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy101;
+	if (yych <= '/') goto yy31;
+	if (yych <= '9') goto yy83;
+	goto yy31;
+yy87:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy103;
+		} else {
+			if (yych <= ':') goto yy67;
+			if (yych <= '@') goto yy31;
+			goto yy103;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy103;
+			goto yy31;
+		}
+	}
+yy88:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy103;
+			if (yych <= ':') goto yy67;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy103;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy103;
+			goto yy31;
+		}
+	}
+yy89:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy103;
+		} else {
+			if (yych <= ':') goto yy67;
+			if (yych <= '@') goto yy31;
+			goto yy103;
+		}
+	} else {
+		if (yych <= '`') {
+			if (yych == ']') goto yy52;
+			goto yy31;
+		} else {
+			if (yych <= 'e') goto yy103;
+			if (yych <= 'f') goto yy104;
+			goto yy31;
+		}
+	}
+yy90:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '%') {
+			if (yych <= '$') goto yy31;
+			goto yy105;
+		} else {
+			if (yych <= '/') goto yy31;
+			if (yych <= '9') goto yy45;
+			goto yy106;
+		}
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy45;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy45;
+			goto yy31;
+		}
+	}
+yy91:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy59;
+	goto yy31;
+yy92:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy107;
+		if (yych >= ';') goto yy31;
+	} else {
+		if (yych <= 'F') goto yy107;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy107;
+		goto yy31;
+	}
+yy93:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy108;
+		if (yych <= ':') goto yy109;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy108;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy108;
+		goto yy31;
+	}
+yy94:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy110;
+			if (yych <= ':') goto yy111;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy110;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy110;
+			goto yy31;
+		}
+	}
+yy95:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy112;
+			if (yych <= ':') goto yy111;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy110;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy110;
+			goto yy31;
+		}
+	}
+yy96:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '4') goto yy112;
+			if (yych <= '5') goto yy113;
+			if (yych <= '9') goto yy114;
+			goto yy111;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy110;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy110;
+			goto yy31;
+		}
+	}
+yy97:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy114;
+			if (yych <= ':') goto yy111;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy110;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy110;
+			goto yy31;
+		}
+	}
+yy98:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy110;
+		} else {
+			if (yych <= ':') goto yy111;
+			if (yych <= '@') goto yy31;
+			goto yy110;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy110;
+			goto yy31;
+		}
+	}
+yy99:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy115;
+		} else {
+			if (yych <= ':') goto yy79;
+			if (yych <= '@') goto yy31;
+			goto yy115;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy115;
+			goto yy31;
+		}
+	}
+yy100:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy115;
+			if (yych <= ':') goto yy79;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy115;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy115;
+			goto yy31;
+		}
+	}
+yy101:
+	yych = *++URLG(url_str);
+	if (yych <= '1') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '0') goto yy116;
+		goto yy117;
+	} else {
+		if (yych <= '2') goto yy118;
+		if (yych <= '9') goto yy119;
+		goto yy31;
+	}
+yy102:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy101;
+	if (yych <= '/') goto yy31;
+	if (yych <= '5') goto yy83;
+	goto yy31;
+yy103:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy67;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy104:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy120;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy105:
+	yych = *++URLG(url_str);
+	if (yych == ']') goto yy31;
+	goto yy122;
+yy106:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '1') {
+			if (yych <= '/') goto yy31;
+			if (yych <= '0') goto yy123;
+			goto yy124;
+		} else {
+			if (yych <= '2') goto yy125;
+			if (yych <= '9') goto yy126;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy127;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy127;
+			goto yy31;
+		}
+	}
+yy107:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy128;
+		if (yych <= ':') goto yy93;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy128;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy128;
+		goto yy31;
+	}
+yy108:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy129;
+		if (yych <= ':') goto yy130;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy129;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy129;
+		goto yy31;
+	}
+yy109:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '1') {
+			if (yych <= '/') goto yy31;
+			if (yych <= '0') goto yy131;
+			goto yy132;
+		} else {
+			if (yych <= '2') goto yy133;
+			if (yych <= '9') goto yy134;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy135;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy135;
+			goto yy31;
+		}
+	}
+yy110:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy136;
+		} else {
+			if (yych <= ':') goto yy111;
+			if (yych <= '@') goto yy31;
+			goto yy136;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy136;
+			goto yy31;
+		}
+	}
+yy111:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy135;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy135;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy135;
+		goto yy31;
+	}
+yy112:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy137;
+			if (yych <= ':') goto yy111;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy136;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy136;
+			goto yy31;
+		}
+	}
+yy113:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '5') goto yy137;
+			if (yych <= '9') goto yy136;
+			goto yy111;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy136;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy136;
+			goto yy31;
+		}
+	}
+yy114:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy136;
+			if (yych <= ':') goto yy111;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy136;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy136;
+			goto yy31;
+		}
+	}
+yy115:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy79;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy116:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy138;
+	goto yy31;
+yy117:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy138;
+	if (yych <= '/') goto yy31;
+	if (yych <= '9') goto yy119;
+	goto yy31;
+yy118:
+	yych = *++URLG(url_str);
+	if (yych <= '/') {
+		if (yych == '.') goto yy138;
+		goto yy31;
+	} else {
+		if (yych <= '4') goto yy119;
+		if (yych <= '5') goto yy139;
+		if (yych <= '9') goto yy116;
+		goto yy31;
+	}
+yy119:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy138;
+	if (yych <= '/') goto yy31;
+	if (yych <= '9') goto yy116;
+	goto yy31;
+yy120:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych <= '0') {
+			if (yych <= '/') goto yy31;
+			goto yy140;
+		} else {
+			if (yych <= '1') goto yy61;
+			if (yych <= '2') goto yy62;
+			goto yy63;
+		}
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy64;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy64;
+			goto yy31;
+		}
+	}
+yy121:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+yy122:
+	if (yybm[0+yych] & 128) {
+		goto yy121;
+	}
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy123:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '-') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '.') goto yy65;
+			if (yych <= '/') goto yy31;
+			if (yych <= '9') goto yy141;
+			goto yy142;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy141;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy141;
+			goto yy31;
+		}
+	}
+yy124:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '-') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '.') goto yy65;
+			if (yych <= '/') goto yy31;
+			if (yych <= '9') goto yy143;
+			goto yy142;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy141;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy141;
+			goto yy31;
+		}
+	}
+yy125:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych <= '.') {
+			if (yych == '%') goto yy105;
+			if (yych <= '-') goto yy31;
+			goto yy65;
+		} else {
+			if (yych <= '/') goto yy31;
+			if (yych <= '4') goto yy143;
+			if (yych <= '5') goto yy144;
+			goto yy145;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= ':') goto yy142;
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy141;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy141;
+			goto yy31;
+		}
+	}
+yy126:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '-') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '.') goto yy65;
+			if (yych <= '/') goto yy31;
+			if (yych <= '9') goto yy145;
+			goto yy142;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy141;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy141;
+			goto yy31;
+		}
+	}
+yy127:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy141;
+			if (yych <= ':') goto yy142;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy141;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy141;
+			goto yy31;
+		}
+	}
+yy128:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy93;
+	goto yy31;
+yy129:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy146;
+		if (yych >= ';') goto yy31;
+	} else {
+		if (yych <= 'F') goto yy146;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy146;
+		goto yy31;
+	}
+yy130:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy147;
+		if (yych <= ':') goto yy148;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy147;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy147;
+		goto yy31;
+	}
+yy131:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy149;
+			if (yych <= ':') goto yy150;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy149;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy149;
+			goto yy31;
+		}
+	}
+yy132:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy151;
+			if (yych <= ':') goto yy150;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy149;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy149;
+			goto yy31;
+		}
+	}
+yy133:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '4') goto yy151;
+			if (yych <= '5') goto yy152;
+			if (yych <= '9') goto yy153;
+			goto yy150;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy149;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy149;
+			goto yy31;
+		}
+	}
+yy134:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy153;
+			if (yych <= ':') goto yy150;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy149;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy149;
+			goto yy31;
+		}
+	}
+yy135:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy149;
+		} else {
+			if (yych <= ':') goto yy150;
+			if (yych <= '@') goto yy31;
+			goto yy149;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy149;
+			goto yy31;
+		}
+	}
+yy136:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy154;
+		} else {
+			if (yych <= ':') goto yy111;
+			if (yych <= '@') goto yy31;
+			goto yy154;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy154;
+			goto yy31;
+		}
+	}
+yy137:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy154;
+			if (yych <= ':') goto yy111;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy154;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy154;
+			goto yy31;
+		}
+	}
+yy138:
+	yych = *++URLG(url_str);
+	if (yych <= '1') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '0') goto yy155;
+		goto yy156;
+	} else {
+		if (yych <= '2') goto yy157;
+		if (yych <= '9') goto yy158;
+		goto yy31;
+	}
+yy139:
+	yych = *++URLG(url_str);
+	if (yych == '.') goto yy138;
+	if (yych <= '/') goto yy31;
+	if (yych <= '5') goto yy116;
+	goto yy31;
+yy140:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy78;
+			if (yych <= ':') goto yy159;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy78;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy78;
+			goto yy31;
+		}
+	}
+yy141:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy160;
+			if (yych >= ';') goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy160;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy160;
+			goto yy31;
+		}
+	}
+yy142:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy161;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy161;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy161;
+		goto yy31;
+	}
+yy143:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '-') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '.') goto yy65;
+			if (yych <= '/') goto yy31;
+			if (yych <= '9') goto yy162;
+			goto yy142;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy160;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy160;
+			goto yy31;
+		}
+	}
+yy144:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych <= '-') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '.') goto yy65;
+			if (yych <= '/') goto yy31;
+			if (yych <= '5') goto yy162;
+			goto yy160;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= ':') goto yy142;
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy160;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy160;
+			goto yy31;
+		}
+	}
+yy145:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '-') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '.') goto yy65;
+			if (yych <= '/') goto yy31;
+			if (yych <= '9') goto yy160;
+			goto yy142;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy160;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy160;
+			goto yy31;
+		}
+	}
+yy146:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy163;
+		if (yych <= ':') goto yy130;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy163;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy163;
+		goto yy31;
+	}
+yy147:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy164;
+		if (yych <= ':') goto yy165;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy164;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy164;
+		goto yy31;
+	}
+yy148:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '1') {
+			if (yych <= '/') goto yy31;
+			if (yych <= '0') goto yy166;
+			goto yy167;
+		} else {
+			if (yych <= '2') goto yy168;
+			if (yych <= '9') goto yy169;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy170;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy170;
+			goto yy31;
+		}
+	}
+yy149:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy171;
+		} else {
+			if (yych <= ':') goto yy150;
+			if (yych <= '@') goto yy31;
+			goto yy171;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy171;
+			goto yy31;
+		}
+	}
+yy150:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy170;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy170;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy170;
+		goto yy31;
+	}
+yy151:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy172;
+			if (yych <= ':') goto yy150;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy171;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy171;
+			goto yy31;
+		}
+	}
+yy152:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '5') goto yy172;
+			if (yych <= '9') goto yy171;
+			goto yy150;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy171;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy171;
+			goto yy31;
+		}
+	}
+yy153:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy171;
+			if (yych <= ':') goto yy150;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy171;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy171;
+			goto yy31;
+		}
+	}
+yy154:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy111;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy155:
+	yych = *++URLG(url_str);
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy156:
+	yych = *++URLG(url_str);
+	if (yych <= '/') goto yy31;
+	if (yych <= '9') goto yy158;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy157:
+	yych = *++URLG(url_str);
+	if (yych <= '5') {
+		if (yych <= '/') goto yy31;
+		if (yych >= '5') goto yy173;
+	} else {
+		if (yych <= '9') goto yy155;
+		if (yych == ']') goto yy52;
+		goto yy31;
+	}
+yy158:
+	yych = *++URLG(url_str);
+	if (yych <= '/') goto yy31;
+	if (yych <= '9') goto yy155;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy159:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych <= '0') {
+			if (yych <= '/') goto yy31;
+			goto yy174;
+		} else {
+			if (yych <= '1') goto yy95;
+			if (yych <= '2') goto yy96;
+			goto yy97;
+		}
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy98;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy98;
+			goto yy31;
+		}
+	}
+yy160:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy175;
+			if (yych <= ':') goto yy142;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy175;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy175;
+			goto yy31;
+		}
+	}
+yy161:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy176;
+			if (yych <= ':') goto yy177;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy176;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy176;
+			goto yy31;
+		}
+	}
+yy162:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '-') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '.') goto yy65;
+			if (yych <= '/') goto yy31;
+			if (yych <= '9') goto yy175;
+			goto yy142;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy175;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy175;
+			goto yy31;
+		}
+	}
+yy163:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy130;
+	goto yy31;
+yy164:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy178;
+		if (yych >= ';') goto yy31;
+	} else {
+		if (yych <= 'F') goto yy178;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy178;
+		goto yy31;
+	}
+yy165:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy179;
+		if (yych <= ':') goto yy180;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy179;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy179;
+		goto yy31;
+	}
+yy166:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy181;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy181;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy181;
+			goto yy31;
+		}
+	}
+yy167:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy183;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy181;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy181;
+			goto yy31;
+		}
+	}
+yy168:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '4') goto yy183;
+			if (yych <= '5') goto yy184;
+			if (yych <= '9') goto yy185;
+			goto yy182;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy181;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy181;
+			goto yy31;
+		}
+	}
+yy169:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy185;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy181;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy181;
+			goto yy31;
+		}
+	}
+yy170:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy181;
+		} else {
+			if (yych <= ':') goto yy182;
+			if (yych <= '@') goto yy31;
+			goto yy181;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy181;
+			goto yy31;
+		}
+	}
+yy171:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy186;
+		} else {
+			if (yych <= ':') goto yy150;
+			if (yych <= '@') goto yy31;
+			goto yy186;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy186;
+			goto yy31;
+		}
+	}
+yy172:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy186;
+			if (yych <= ':') goto yy150;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy186;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy186;
+			goto yy31;
+		}
+	}
+yy173:
+	yych = *++URLG(url_str);
+	if (yych <= '/') goto yy31;
+	if (yych <= '5') goto yy155;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy174:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy110;
+			if (yych <= ':') goto yy187;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy110;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy110;
+			goto yy31;
+		}
+	}
+yy175:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych == '%') goto yy105;
+		goto yy31;
+	} else {
+		if (yych <= ':') goto yy142;
+		if (yych == ']') goto yy52;
+		goto yy31;
+	}
+yy176:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy188;
+			if (yych >= ';') goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy188;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy188;
+			goto yy31;
+		}
+	}
+yy177:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy189;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy189;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy189;
+		goto yy31;
+	}
+yy178:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy190;
+		if (yych <= ':') goto yy165;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy190;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy190;
+		goto yy31;
+	}
+yy179:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy191;
+		if (yych <= ':') goto yy192;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy191;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy191;
+		goto yy31;
+	}
+yy180:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy193;
+		if (yych <= '@') goto yy31;
+		goto yy193;
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy193;
+			goto yy31;
+		}
+	}
+yy181:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy194;
+		} else {
+			if (yych <= ':') goto yy182;
+			if (yych <= '@') goto yy31;
+			goto yy194;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy194;
+			goto yy31;
+		}
+	}
+yy182:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy193;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy193;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy193;
+		goto yy31;
+	}
+yy183:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy195;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy194;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy194;
+			goto yy31;
+		}
+	}
+yy184:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '5') goto yy195;
+			if (yych <= '9') goto yy194;
+			goto yy182;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy194;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy194;
+			goto yy31;
+		}
+	}
+yy185:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy194;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy194;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy194;
+			goto yy31;
+		}
+	}
+yy186:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy150;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy187:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych <= '0') {
+			if (yych <= '/') goto yy31;
+			goto yy196;
+		} else {
+			if (yych <= '1') goto yy132;
+			if (yych <= '2') goto yy133;
+			goto yy134;
+		}
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy135;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy135;
+			goto yy31;
+		}
+	}
+yy188:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy197;
+			if (yych <= ':') goto yy177;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy197;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy197;
+			goto yy31;
+		}
+	}
+yy189:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy198;
+			if (yych <= ':') goto yy199;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy198;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy198;
+			goto yy31;
+		}
+	}
+yy190:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy165;
+	goto yy31;
+yy191:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy200;
+		if (yych >= ';') goto yy31;
+	} else {
+		if (yych <= 'F') goto yy200;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy200;
+		goto yy31;
+	}
+yy192:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy201;
+		if (yych <= ':') goto yy202;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy201;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy201;
+		goto yy31;
+	}
+yy193:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy203;
+		} else {
+			if (yych <= ':') goto yy204;
+			if (yych <= '@') goto yy31;
+			goto yy203;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy203;
+			goto yy31;
+		}
+	}
+yy194:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy205;
+		} else {
+			if (yych <= ':') goto yy182;
+			if (yych <= '@') goto yy31;
+			goto yy205;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy205;
+			goto yy31;
+		}
+	}
+yy195:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy205;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy205;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy205;
+			goto yy31;
+		}
+	}
+yy196:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy149;
+			if (yych <= ':') goto yy206;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy149;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy149;
+			goto yy31;
+		}
+	}
+yy197:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych == '%') goto yy105;
+		goto yy31;
+	} else {
+		if (yych <= ':') goto yy177;
+		if (yych == ']') goto yy52;
+		goto yy31;
+	}
+yy198:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy207;
+			if (yych >= ';') goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy207;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy207;
+			goto yy31;
+		}
+	}
+yy199:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy208;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy208;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy208;
+		goto yy31;
+	}
+yy200:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy209;
+		if (yych <= ':') goto yy192;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy209;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy209;
+		goto yy31;
+	}
+yy201:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy210;
+		if (yych <= ':') goto yy211;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy210;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy210;
+		goto yy31;
+	}
+yy202:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy212;
+		if (yych <= '@') goto yy31;
+		goto yy212;
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy212;
+			goto yy31;
+		}
+	}
+yy203:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy213;
+		} else {
+			if (yych <= ':') goto yy204;
+			if (yych <= '@') goto yy31;
+			goto yy213;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy213;
+			goto yy31;
+		}
+	}
+yy204:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy212;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy212;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy212;
+		goto yy31;
+	}
+yy205:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy182;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy206:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych <= '0') {
+			if (yych <= '/') goto yy31;
+			goto yy214;
+		} else {
+			if (yych <= '1') goto yy167;
+			if (yych <= '2') goto yy168;
+			goto yy169;
+		}
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy170;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy170;
+			goto yy31;
+		}
+	}
+yy207:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy215;
+			if (yych <= ':') goto yy199;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy215;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy215;
+			goto yy31;
+		}
+	}
+yy208:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy216;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy216;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy216;
+			goto yy31;
+		}
+	}
+yy209:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy192;
+	goto yy31;
+yy210:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy217;
+		if (yych >= ';') goto yy31;
+	} else {
+		if (yych <= 'F') goto yy217;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy217;
+		goto yy31;
+	}
+yy211:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy212;
+		if (yych <= ':') goto yy155;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy212;
+		if (yych <= '`') goto yy31;
+		if (yych >= 'g') goto yy31;
+	}
+yy212:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy218;
+		if (yych <= '@') goto yy31;
+		goto yy218;
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy218;
+			goto yy31;
+		}
+	}
+yy213:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '9') {
+			if (yych <= '/') goto yy31;
+			goto yy219;
+		} else {
+			if (yych <= ':') goto yy204;
+			if (yych <= '@') goto yy31;
+			goto yy219;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy219;
+			goto yy31;
+		}
+	}
+yy214:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy181;
+			if (yych <= ':') goto yy220;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy181;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy181;
+			goto yy31;
+		}
+	}
+yy215:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych == '%') goto yy105;
+		goto yy31;
+	} else {
+		if (yych <= ':') goto yy199;
+		if (yych == ']') goto yy52;
+		goto yy31;
+	}
+yy216:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy221;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy221;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy221;
+			goto yy31;
+		}
+	}
+yy217:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy222;
+		if (yych <= ':') goto yy211;
+		goto yy31;
+	} else {
+		if (yych <= 'F') goto yy222;
+		if (yych <= '`') goto yy31;
+		if (yych <= 'f') goto yy222;
+		goto yy31;
+	}
+yy218:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy223;
+		if (yych <= '@') goto yy31;
+		goto yy223;
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy223;
+			goto yy31;
+		}
+	}
+yy219:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy204;
+	if (yych == ']') goto yy52;
+	goto yy31;
+yy220:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych <= '0') {
+			if (yych <= '/') goto yy31;
+			goto yy224;
+		} else {
+			if (yych <= '1') goto yy225;
+			if (yych <= '2') goto yy226;
+			goto yy227;
+		}
+	} else {
+		if (yych <= 'F') {
+			if (yych <= '@') goto yy31;
+			goto yy193;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy193;
+			goto yy31;
+		}
+	}
+yy221:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '%') goto yy105;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy228;
+			if (yych <= ':') goto yy182;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy228;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy228;
+			goto yy31;
+		}
+	}
+yy222:
+	yych = *++URLG(url_str);
+	if (yych == ':') goto yy211;
+	goto yy31;
+yy223:
+	yych = *++URLG(url_str);
+	if (yych <= 'F') {
+		if (yych <= '/') goto yy31;
+		if (yych <= '9') goto yy155;
+		if (yych <= '@') goto yy31;
+		goto yy155;
+	} else {
+		if (yych <= ']') {
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy155;
+			goto yy31;
+		}
+	}
+yy224:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy203;
+			if (yych <= ':') goto yy204;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy203;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy203;
+			goto yy31;
+		}
+	}
+yy225:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy229;
+			if (yych <= ':') goto yy204;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy203;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy203;
+			goto yy31;
+		}
+	}
+yy226:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '4') goto yy229;
+			if (yych <= '5') goto yy230;
+			if (yych <= '9') goto yy231;
+			goto yy204;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy203;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy203;
+			goto yy31;
+		}
+	}
+yy227:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy231;
+			if (yych <= ':') goto yy204;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy203;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy203;
+			goto yy31;
+		}
+	}
+yy228:
+	yych = *++URLG(url_str);
+	if (yych <= '9') {
+		if (yych == '%') goto yy105;
+		goto yy31;
+	} else {
+		if (yych <= ':') goto yy182;
+		if (yych == ']') goto yy52;
+		goto yy31;
+	}
+yy229:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy232;
+			if (yych <= ':') goto yy204;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy213;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy213;
+			goto yy31;
+		}
+	}
+yy230:
+	yych = *++URLG(url_str);
+	if (yych <= ':') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '5') goto yy232;
+			if (yych <= '9') goto yy213;
+			goto yy204;
+		}
+	} else {
+		if (yych <= '\\') {
+			if (yych <= '@') goto yy31;
+			if (yych <= 'F') goto yy213;
+			goto yy31;
+		} else {
+			if (yych <= ']') goto yy52;
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy213;
+			goto yy31;
+		}
+	}
+yy231:
+	yych = *++URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy213;
+			if (yych <= ':') goto yy204;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy213;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy213;
+			goto yy31;
+		}
+	}
+yy232:
+	++URLG(url_str);
+	if ((yych = *URLG(url_str)) <= '@') {
+		if (yych <= '/') {
+			if (yych == '.') goto yy65;
+			goto yy31;
+		} else {
+			if (yych <= '9') goto yy219;
+			if (yych <= ':') goto yy204;
+			goto yy31;
+		}
+	} else {
+		if (yych <= ']') {
+			if (yych <= 'F') goto yy219;
+			if (yych <= '\\') goto yy31;
+			goto yy52;
+		} else {
+			if (yych <= '`') goto yy31;
+			if (yych <= 'f') goto yy219;
+			goto yy31;
+		}
+	}
+}
+#line 144 "ext/standard/url_parser_ex.re"
+
+host:;
+    int len = URLG(url_str) - marker;
+    url->host = get_token(len);
+    return;
+}
+
+void url_parse_authority_port (php_url *url)
+{
+    marker = URLG(url_str);
+
+#line 3624 "ext/standard/url_parser_ex.c"
+{
+	unsigned char yych;
+	static const unsigned char yybm[] = {
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+	};
+	yych = *URLG(url_str);
+	if (yych <= 0x00) goto yy236;
+	if (yych == ':') goto yy238;
+#line 157 "ext/standard/url_parser_ex.re"
+	{ return; }
+#line 3666 "ext/standard/url_parser_ex.c"
+yy236:
+	++URLG(url_str);
+#line 156 "ext/standard/url_parser_ex.re"
+	{ URLG(url_str)--; return; }
+#line 3671 "ext/standard/url_parser_ex.c"
+yy238:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yybm[0+yych] & 128) {
+		goto yy238;
+	}
+#line 158 "ext/standard/url_parser_ex.re"
+	{
+        marker++;
+        int len = URLG(url_str) - marker;
+        char* port = get_token(len);
+        url->port = atoi(port);
+        efree(port);
+        return;
+    }
+#line 3687 "ext/standard/url_parser_ex.c"
+}
+#line 166 "ext/standard/url_parser_ex.re"
+
+}
+
+void url_parse_authority (php_url *url)
+{
+
+#line 3696 "ext/standard/url_parser_ex.c"
+{
+	unsigned char yych;
+	yych = *(YYMARKER = URLG(url_str));
+	if (yych <= 0x00) goto yy244;
+	if (yych == '/') goto yy246;
+yy243:
+#line 173 "ext/standard/url_parser_ex.re"
+	{ return; }
+#line 3705 "ext/standard/url_parser_ex.c"
+yy244:
+	++URLG(url_str);
+#line 172 "ext/standard/url_parser_ex.re"
+	{ URLG(url_str)--; return; }
+#line 3710 "ext/standard/url_parser_ex.c"
+yy246:
+	yych = *++URLG(url_str);
+	if (yych == '/') goto yy248;
+	URLG(url_str) = YYMARKER;
+	goto yy243;
+yy248:
+	++URLG(url_str);
+#line 174 "ext/standard/url_parser_ex.re"
+	{
+        goto authority;
+    }
+#line 3722 "ext/standard/url_parser_ex.c"
+}
+#line 177 "ext/standard/url_parser_ex.re"
+
+authority:;
+    url_parse_authority_userinfo(url);
+    url_parse_authority_host(url);
+    url_parse_authority_port(url);
+    return;
+}
+
+void url_parse_path (php_url *url)
+{
+    marker = URLG(url_str);
+
+#line 3737 "ext/standard/url_parser_ex.c"
+{
+	unsigned char yych;
+	static const unsigned char yybm[] = {
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0, 128,   0,   0, 128,   0, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128,   0, 128,   0,   0, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0,   0, 128, 
+		  0, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0, 128,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+	};
+	yych = *(YYMARKER = URLG(url_str));
+	if (yybm[0+yych] & 128) {
+		goto yy255;
+	}
+	if (yych <= 0x00) goto yy253;
+	if (yych <= '#') goto yy252;
+	if (yych <= '%') goto yy257;
+yy252:
+#line 201 "ext/standard/url_parser_ex.re"
+	{
+        int len = URLG(url_str) - marker;
+
+        if (len) {
+            url->path = get_token(len);
+        }
+
+        return;
+    }
+#line 3792 "ext/standard/url_parser_ex.c"
+yy253:
+	++URLG(url_str);
+#line 200 "ext/standard/url_parser_ex.re"
+	{ URLG(url_str)--; return; }
+#line 3797 "ext/standard/url_parser_ex.c"
+yy255:
+	YYMARKER = ++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yybm[0+yych] & 128) {
+		goto yy255;
+	}
+	if (yych <= '#') goto yy252;
+	if (yych >= '&') goto yy252;
+yy257:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy258;
+		if (yych <= '9') goto yy259;
+	} else {
+		if (yych <= 'F') goto yy259;
+		if (yych <= '`') goto yy258;
+		if (yych <= 'f') goto yy259;
+	}
+yy258:
+	URLG(url_str) = YYMARKER;
+	goto yy252;
+yy259:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy258;
+		if (yych <= '9') goto yy255;
+		goto yy258;
+	} else {
+		if (yych <= 'F') goto yy255;
+		if (yych <= '`') goto yy258;
+		if (yych <= 'f') goto yy255;
+		goto yy258;
+	}
+}
+#line 210 "ext/standard/url_parser_ex.re"
+
+}
+
+void url_parse_query_frag (php_url *url)
+{
+query_frag:;
+    marker = URLG(url_str);
+
+
+#line 3844 "ext/standard/url_parser_ex.c"
+{
+	unsigned char yych;
+	unsigned int yyaccept = 0;
+	static const unsigned char yybm[] = {
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0, 128,   0,   0, 128,   0, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128,   0, 128,   0, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0,   0, 128, 
+		  0, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128, 128, 128, 128, 128, 128, 
+		128, 128, 128,   0,   0,   0, 128,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+		  0,   0,   0,   0,   0,   0,   0,   0, 
+	};
+	yych = *URLG(url_str);
+	if (yych <= '#') {
+		if (yych <= 0x00) goto yy263;
+		if (yych >= '#') goto yy265;
+	} else {
+		if (yych == '?') goto yy268;
+	}
+#line 223 "ext/standard/url_parser_ex.re"
+	{ return; }
+#line 3891 "ext/standard/url_parser_ex.c"
+yy263:
+	++URLG(url_str);
+#line 222 "ext/standard/url_parser_ex.re"
+	{ URLG(url_str)--; return; }
+#line 3896 "ext/standard/url_parser_ex.c"
+yy265:
+	yyaccept = 0;
+	YYMARKER = ++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yybm[0+yych] & 128) {
+		goto yy265;
+	}
+	if (yych <= '#') goto yy267;
+	if (yych <= '%') goto yy271;
+yy267:
+#line 232 "ext/standard/url_parser_ex.re"
+	{
+        marker++;
+        int len = URLG(url_str) - marker;
+        if (len) {
+            url->fragment = get_token(len);
+        }
+        return;
+    }
+#line 3916 "ext/standard/url_parser_ex.c"
+yy268:
+	yyaccept = 1;
+	YYMARKER = ++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '=') {
+		if (yych <= '$') {
+			if (yych == '!') goto yy268;
+			if (yych >= '$') goto yy268;
+		} else {
+			if (yych <= '%') goto yy273;
+			if (yych != '<') goto yy268;
+		}
+	} else {
+		if (yych <= '_') {
+			if (yych <= '>') goto yy270;
+			if (yych <= 'Z') goto yy268;
+			if (yych >= '_') goto yy268;
+		} else {
+			if (yych <= 'z') {
+				if (yych >= 'a') goto yy268;
+			} else {
+				if (yych == '~') goto yy268;
+			}
+		}
+	}
+yy270:
+#line 224 "ext/standard/url_parser_ex.re"
+	{
+        marker++;
+        int len = URLG(url_str) - marker;
+        if (len) {
+            url->query = get_token(len);
+        }
+        goto query_frag;
+    }
+#line 3952 "ext/standard/url_parser_ex.c"
+yy271:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy272;
+		if (yych <= '9') goto yy274;
+	} else {
+		if (yych <= 'F') goto yy274;
+		if (yych <= '`') goto yy272;
+		if (yych <= 'f') goto yy274;
+	}
+yy272:
+	URLG(url_str) = YYMARKER;
+	if (yyaccept == 0) {
+		goto yy267;
+	} else {
+		goto yy270;
+	}
+yy273:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy272;
+		if (yych <= '9') goto yy275;
+		goto yy272;
+	} else {
+		if (yych <= 'F') goto yy275;
+		if (yych <= '`') goto yy272;
+		if (yych <= 'f') goto yy275;
+		goto yy272;
+	}
+yy274:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy272;
+		if (yych <= '9') goto yy265;
+		goto yy272;
+	} else {
+		if (yych <= 'F') goto yy265;
+		if (yych <= '`') goto yy272;
+		if (yych <= 'f') goto yy265;
+		goto yy272;
+	}
+yy275:
+	++URLG(url_str);
+	yych = *URLG(url_str);
+	if (yych <= '@') {
+		if (yych <= '/') goto yy272;
+		if (yych <= '9') goto yy268;
+		goto yy272;
+	} else {
+		if (yych <= 'F') goto yy268;
+		if (yych <= '`') goto yy272;
+		if (yych <= 'f') goto yy268;
+		goto yy272;
+	}
+}
+#line 240 "ext/standard/url_parser_ex.re"
+
+}
diff --git a/ext/standard/url_parser_ex.h b/ext/standard/url_parser_ex.h
new file mode 100644
index 000000000000..282ff04fe285
--- /dev/null
+++ b/ext/standard/url_parser_ex.h
@@ -0,0 +1,38 @@
+/*
+   +----------------------------------------------------------------------+
+   | PHP Version 7                                                        |
+   +----------------------------------------------------------------------+
+   | Copyright (c) 1997-2016 The PHP Group                                |
+   +----------------------------------------------------------------------+
+   | This source file is subject to version 3.01 of the PHP license,      |
+   | that is bundled with this package in the file LICENSE, and is        |
+   | available through the world-wide-web at the following url:           |
+   | http://www.php.net/license/3_01.txt                                  |
+   | If you did not receive a copy of the PHP license and are unable to   |
+   | obtain it through the world-wide-web, please send a note to          |
+   | license@php.net so we can mail you a copy immediately.               |
+   +----------------------------------------------------------------------+
+ */
+
+/**
+ * Url Parser used from https://github.com/staskobzar/url_parser_re2c
+ * Licensed under MIT License.
+ *
+ * Modified for more correct RFC 3986 requirements & PHP
+ */
+#ifndef URL_PARSER_EX_H
+#define URL_PARSER_EX_H
+
+void url_parse_scheme(php_url *url);
+void url_parse_authority(php_url *url);
+void url_parse_path(php_url *url);
+void url_parse_query_frag(php_url *url);
+
+#endif /* URL_PARSER_EX_H */
+
+/*
+ * Local variables:
+ * tab-width: 4
+ * c-basic-offset: 4
+ * End:
+ */
diff --git a/ext/standard/url_parser_ex.re b/ext/standard/url_parser_ex.re
new file mode 100644
index 000000000000..d7a8dc0ffaab
--- /dev/null
+++ b/ext/standard/url_parser_ex.re
@@ -0,0 +1,243 @@
+/*
+   +----------------------------------------------------------------------+
+   | PHP Version 7                                                        |
+   +----------------------------------------------------------------------+
+   | Copyright (c) 1997-2016 The PHP Group                                |
+   +----------------------------------------------------------------------+
+   | This source file is subject to version 3.01 of the PHP license,      |
+   | that is bundled with this package in the file LICENSE, and is        |
+   | available through the world-wide-web at the following url:           |
+   | http://www.php.net/license/3_01.txt                                  |
+   | If you did not receive a copy of the PHP license and are unable to   |
+   | obtain it through the world-wide-web, please send a note to          |
+   | license@php.net so we can mail you a copy immediately.               |
+   +----------------------------------------------------------------------+
+   | Author: David Walker (dave@mudsite.com)                              |
+   +----------------------------------------------------------------------+
+ */
+
+/**
+ * Url Parser used from https://github.com/staskobzar/url_parser_re2c
+ * Licensed under MIT License.
+ *
+ * Modified for more correct RFC 3986 requirements & PHP
+ */
+
+#include <stdlib.h>
+#include <signal.h>
+#include <string.h>
+#include <ctype.h>
+#include <sys/types.h>
+
+#include "php.h"
+#include "url.h"
+#include "url_parser_ex.h"
+
+ZEND_DECLARE_MODULE_GLOBALS(url)
+
+/* Since YYMARKER increments on wildcards, we'll track ourselves. */
+const char *marker;
+const char *YYMARKER;
+
+char* get_token(int len)
+{
+    char *res = (char *) emalloc (len + 1);
+    int i = 0;
+    for (; i < len; i++) res[i] = marker[i];
+    res[i] = '\0';
+    return res;
+}
+
+/*!re2c
+    re2c:define:YYCTYPE = "unsigned char";
+    re2c:define:YYCURSOR = URLG(url_str);
+    re2c:yyfill:enable = 0;
+
+    EOF = "\x00";
+    ALPHA = [a-zA-Z];
+    DIGIT = [0-9];
+    HEXDIG = [0-9a-fA-F];
+    SUB_DELIMS = [!$&'()*+,;=];
+    GEN_DELIMS = [:/?#\[\]@];
+    RESERVED = GEN_DELIMS | SUB_DELIMS;
+    UNRESERVED = ALPHA | DIGIT | [-._~];
+    PCT_ENCODED = "%" HEXDIG HEXDIG;
+    PCHAR = UNRESERVED | PCT_ENCODED | SUB_DELIMS | ":" | "@";
+*/
+
+void url_parse_scheme(php_url *url)
+{
+    marker = URLG(url_str);
+/*!re2c
+    SCHEME = ALPHA (ALPHA | DIGIT | [+-.])*;
+
+    EOF { URLG(url_str)--; return; }
+    "" { return; }
+    SCHEME ":" {
+        int len = URLG(url_str) - marker - 1;
+        url->scheme = get_token(len);
+        return;
+    }
+*/
+}
+
+void url_parse_authority_userinfo (php_url *url)
+{
+    marker = URLG(url_str);
+/*!re2c
+    USERINFO = (UNRESERVED | PCT_ENCODED | SUB_DELIMS | ":")*;
+
+    EOF { URLG(url_str)--; return; }
+    "" { return; }
+    USERINFO "@" {
+        int len = 0;
+        len = URLG(url_str) - marker;
+
+        char* split = memchr(marker, ':', len);
+        if (split && split < URLG(url_str)) {
+            len = split - marker;
+            if (len > 0) url->user = get_token(len);
+            marker += len + 1;
+            len = URLG(url_str) - split - 2;
+            if (len > 0) url->pass = get_token(len);
+            return;
+        } else {
+            int len = URLG(url_str) - marker - 1;
+            if (len > 0) url->user = get_token(len);
+            return;
+        }
+    }
+*/
+}
+
+void url_parse_authority_host (php_url *url)
+{
+    marker = URLG(url_str);
+/*!re2c
+    DEC_OCTET = DIGIT | [1-9] DIGIT | "1" DIGIT{2} | "2" [0-4] DIGIT | "25" [0-5];
+    IPV4ADDR = (DEC_OCTET "."){3} DEC_OCTET;
+    H16 = HEXDIG{1,4};
+    LS32 = (H16 ":" H16) | IPV4ADDR;
+    IPV6ADDR = "[" (
+        (H16 ":"){7,7} H16|
+        (H16 ":" ){1,7} ":" |
+        (H16 ":" ){1,6} ":" H16|
+        (H16 ":" ){1,5}( ":" H16){1,2}|
+        (H16 ":" ){1,4}( ":" H16){1,3}|
+        (H16 ":" ){1,3}( ":" H16){1,4}|
+        (H16 ":" ){1,2}( ":" H16){1,5}|
+        H16 ":" (( ":" H16){1,6})|
+        ":" (( ":" H16){1,7}| ":" )|
+        "fe80:" ( ":" H16){0,4} "%" [0-9a-zA-Z]{1,}|
+        "::" ( "ffff" ( ":0" {1,4}){0,1} ":" ){0,1}IPV4ADDR|
+        (H16 ":"){1,4} ":" IPV4ADDR
+    ) "]";
+    IPVFUTURE = "[v" HEXDIG+ "." (UNRESERVED | SUB_DELIMS | ":")+ "]";
+    REG_NAME = (UNRESERVED | PCT_ENCODED | SUB_DELIMS)+;
+
+    EOF { URLG(url_str) = marker; return; }
+    "" { return; }
+    IPV4ADDR | REG_NAME {
+        goto host;
+    }
+    IPV6ADDR | IPVFUTURE {
+        goto host;
+    }
+*/
+host:;
+    int len = URLG(url_str) - marker;
+    url->host = get_token(len);
+    return;
+}
+
+void url_parse_authority_port (php_url *url)
+{
+    marker = URLG(url_str);
+/*!re2c
+
+    EOF { URLG(url_str)--; return; }
+    "" { return; }
+    ":" DIGIT* {
+        marker++;
+        int len = URLG(url_str) - marker;
+        char* port = get_token(len);
+        url->port = atoi(port);
+        efree(port);
+        return;
+    }
+*/
+}
+
+void url_parse_authority (php_url *url)
+{
+/*!re2c
+    EOF { URLG(url_str)--; return; }
+    "" { return; }
+    "//" {
+        goto authority;
+    }
+*/
+authority:;
+    url_parse_authority_userinfo(url);
+    url_parse_authority_host(url);
+    url_parse_authority_port(url);
+    return;
+}
+
+void url_parse_path (php_url *url)
+{
+    marker = URLG(url_str);
+/*!re2c
+    SEGMENT_NZ_NC = (UNRESERVED | PCT_ENCODED | SUB_DELIMS | "@")+;
+    SEGMENT_NZ = PCHAR+;
+    SEGMENT = PCHAR*;
+
+    PATH_ABEMPTY = ("/" SEGMENT)*;
+    PATH_ABSOLUTE = "/" (SEGMENT_NZ ("/" SEGMENT)*)?;
+    PATH_NOSCHEME = SEGMENT_NZ_NC ("/" SEGMENT)*;
+    PATH_ROOTLESS = SEGMENT_NZ ("/" SEGMENT)*;
+    PATH_EMPTY = "";
+    PATH = PATH_ABEMPTY | PATH_ABSOLUTE | PATH_NOSCHEME | PATH_ROOTLESS | PATH_EMPTY;
+
+    EOF { URLG(url_str)--; return; }
+    PATH {
+        int len = URLG(url_str) - marker;
+
+        if (len) {
+            url->path = get_token(len);
+        }
+
+        return;
+    }
+*/
+}
+
+void url_parse_query_frag (php_url *url)
+{
+query_frag:;
+    marker = URLG(url_str);
+
+/*!re2c
+    QUERY = "?" (PCHAR | "/" | "?")*;
+    FRAGMENT = "#" (PCHAR | "/" | "?")*;
+
+    EOF { URLG(url_str)--; return; }
+    "" { return; }
+    QUERY {
+        marker++;
+        int len = URLG(url_str) - marker;
+        if (len) {
+            url->query = get_token(len);
+        }
+        goto query_frag;
+    }
+    FRAGMENT {
+        marker++;
+        int len = URLG(url_str) - marker;
+        if (len) {
+            url->fragment = get_token(len);
+        }
+        return;
+    }
+*/
+}
